import{r,j as e,Y as P,P as I,a2 as L}from"./Icons-C56Ecv4l.js";import{u as O,P as U,c as E}from"./main-CCzraqPD.js";import{N as A}from"./NumericKeypad-CSJS3737.js";import{f as p}from"./formatting-B5pXF3od.js";const F=({setPage:g})=>{const{cashOuts:i,addCashOut:j,showToast:c}=O(),[o,d]=r.useState(""),[l,u]=r.useState(""),[N,x]=r.useState(null),[a,h]=r.useState(null),n=r.useRef(null),w=i.reduce((t,s)=>t+s.amount,0);r.useEffect(()=>()=>{a&&URL.revokeObjectURL(a)},[a]);const v=t=>{d(s=>t==="."?s.includes(".")?s:s===""?"0.":s+".":s.includes(".")&&s.split(".")[1].length>=2?s:s==="0"&&t!=="."?t:s+t)},y=()=>{d(t=>t.slice(0,-1))},R=async t=>{if(t.target.files&&t.target.files[0])try{const s=t.target.files[0],m=await E(s,{maxWidth:600,maxHeight:600});x(m),a&&URL.revokeObjectURL(a);const C=URL.createObjectURL(m);h(C)}catch(s){c(s instanceof Error?s.message:"Erreur lors du traitement de l'image.","error")}},f=()=>{x(null),a&&URL.revokeObjectURL(a),h(null),n.current&&(n.current.value="")},k=()=>{d(""),u(""),f()},S=()=>{const t=parseFloat(o);if(!t||t<=0){c("Veuillez entrer un montant valide.","error");return}if(!l){c("Veuillez entrer une raison pour la sortie.","error");return}j(t,l,N),k()},b="mt-1 block w-full p-3 bg-[#1a1a1a] border-2 border-white/20 text-white rounded-xl shadow-sm focus:ring-2 focus:ring-amber-500 focus:border-amber-500 transition";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-display text-amber-400",children:"Sorties d'Espèces"}),e.jsx("button",{onClick:()=>g(I.More),className:"text-slate-300 hover:text-amber-400 p-2 rounded-full transition-colors","aria-label":"Retour",children:e.jsx(P,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"bg-[#2a2a2a] border-2 border-amber-500/50 p-6 rounded-2xl shadow-lg text-center",children:[e.jsx("h3",{className:"font-bold text-xl text-slate-200",children:"Total des Sorties d'Espèces"}),e.jsx("p",{className:"text-4xl font-display text-amber-300 tracking-wider mt-1",children:p(w)})]}),e.jsxs("div",{className:"bg-[#2a2a2a] p-6 rounded-2xl shadow-md border border-white/10",children:[e.jsx("h2",{className:"text-2xl font-display text-slate-200 mb-4 text-center",children:"Nouvelle Sortie"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300 mb-2",children:"Montant de la sortie"}),e.jsx("div",{className:"text-5xl font-display text-amber-300 p-4 bg-black/30 rounded-lg tracking-wider min-h-[76px] flex items-center justify-center",children:e.jsxs("span",{children:[o||"0.00",e.jsx("span",{className:"text-4xl ml-1",children:"€"})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Raison"}),e.jsx("input",{type:"text",value:l,onChange:t=>u(t.target.value),placeholder:"ex: Achat de glaçons",className:b})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-slate-300",children:"Justificatif (optionnel)"}),a?e.jsxs("div",{className:"mt-2 flex items-center gap-4",children:[e.jsx("img",{src:a,alt:"Aperçu du justificatif",className:"w-20 h-20 rounded-lg object-cover border-2 border-white/20"}),e.jsx("button",{onClick:f,className:"text-sm text-red-400 hover:text-red-300",children:"Supprimer l'image"})]}):e.jsxs("button",{onClick:()=>n.current?.click(),className:`w-full mt-1 flex items-center justify-center gap-2 ${b}`,children:[e.jsx(L,{className:"w-5 h-5"}),"Ajouter une photo"]}),e.jsx("input",{type:"file",ref:n,onChange:R,accept:"image/*",className:"hidden"})]}),e.jsx(A,{onKeyPress:v,onDelete:y}),e.jsx("button",{onClick:S,disabled:!o||!l,className:"!mt-6 w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg disabled:opacity-50 disabled:cursor-not-allowed",children:"Enregistrer la Sortie"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display text-slate-200 mb-2 text-center",children:"Sorties Récentes"}),e.jsx("div",{className:"space-y-3 max-h-80 overflow-y-auto p-2 bg-black/20 rounded-lg",children:i.length>0?i.map(t=>e.jsxs("div",{className:"bg-[#2a2a2a] p-3 rounded-lg shadow-sm border-l-4 border-amber-500 flex items-center gap-4",children:[t.receiptImage&&e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-black/20 flex items-center justify-center flex-shrink-0 border border-white/10",children:e.jsx(U,{image:t.receiptImage,alt:`Justificatif pour ${t.reason}`,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"font-bold text-slate-200",children:t.reason}),e.jsx("p",{className:"text-xs text-slate-400",children:new Date(t.date).toLocaleString("fr-FR")})]}),e.jsxs("p",{className:"font-bold text-lg text-red-400",children:["-",p(t.amount)]})]},t.id)):e.jsx("p",{className:"text-center text-slate-500 p-4",children:"Aucune sortie d'espèces enregistrée."})})]})]})},M=r.memo(F);export{M as default};

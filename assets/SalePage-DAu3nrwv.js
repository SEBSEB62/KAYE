import{R as A,r as s,j as e,z as E,T as I}from"./Icons-C56Ecv4l.js";import{u as j,M as F,P as S}from"./main-CwG_ok6R.js";import{N as L}from"./NumericKeypad-CSJS3737.js";import{f as v}from"./formatting-B5pXF3od.js";import{u as V}from"./useDebounce-7V9QMTWI.js";const w=30,C=30,z=s.memo(({isOpen:t,onClose:d})=>{const{addMiscSaleToCart:a,showToast:l}=j(),[c,r]=s.useState(""),[i,u]=s.useState("");s.useEffect(()=>{t||(r(""),u(""))},[t]);const h=()=>{const x=parseFloat(c);if(isNaN(x)||x<=0){l("Veuillez entrer un montant valide supÃ©rieur Ã  zÃ©ro.","error");return}if(i.length>50){l("La description ne peut pas dÃ©passer 50 caractÃ¨res.","error");return}a(x,i||"Vente Diverse"),d()},p=x=>{r(m=>x==="."?m.includes(".")?m:m===""?"0.":m+".":m.includes(".")&&m.split(".")[1].length>=2?m:m==="0"&&x!=="."?x:m+x)},b=()=>{r(x=>x.slice(0,-1))},n=parseFloat(c)||0,g=n-n*.0175,k=n>0?n-(n*.029+.35):0;return e.jsx(F,{isOpen:t,onClose:d,title:"Ajouter une Vente Diverse",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-center text-slate-500 dark:text-slate-400",children:"Pour un article non listÃ© (ex: table, emplacement...)."}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"misc-name",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Description (optionnel)"}),e.jsx("input",{type:"text",id:"misc-name",value:i,onChange:x=>u(x.target.value),placeholder:"ex: Emplacement B12",className:"block w-full p-2 border-white/20 rounded-md shadow-sm bg-white/20 dark:bg-black/40 text-slate-900 dark:text-white",autoFocus:!0,maxLength:50}),i.length>0&&e.jsxs("p",{className:"text-right text-xs text-slate-500 dark:text-slate-400 mt-1",children:[i.length," / 50"]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"misc-price",className:"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1",children:"Prix (â‚¬)"}),e.jsx("input",{type:"text",id:"misc-price",readOnly:!0,value:c,placeholder:"0.00",className:"block w-full text-center text-3xl p-2 border-white/20 rounded-md shadow-sm bg-white/20 dark:bg-black/40 text-slate-900 dark:text-white font-sans"}),n>0&&e.jsxs("div",{className:"mt-2 text-xs space-y-1 text-center text-slate-500 dark:text-slate-400 bg-black/10 dark:bg-black/30 p-2 rounded-lg",children:[e.jsxs("p",{children:["Net (SumUp): ",e.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:v(g)})]}),e.jsxs("p",{children:["Net (PayPal): ",e.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:v(Math.max(0,k))})]})]})]}),e.jsx(L,{onKeyPress:p,onDelete:b,onDone:h})]})})}),X=s.memo(({product:t,style:d,onClick:a,className:l=""})=>{const{settings:c}=j(),r=t.stock>0,i=c.tokenMode?`${t.tokenPrice||0} Jeton${(t.tokenPrice||0)>1?"s":""}`:`${v(t.price)}`;return e.jsxs("button",{type:"button",className:`absolute w-40 h-52 flex flex-col overflow-hidden rounded-2xl glass-panel shadow-xl shadow-amber-500/10 transition-all duration-300 text-left 
      ${r?"border-white/30 dark:border-white/10":"border-red-500/50 opacity-80"} ${l}`,style:d,"aria-label":t.name,onDragStart:u=>u.preventDefault(),onClick:a,disabled:!r,children:[e.jsx("div",{className:"w-full h-24 flex items-center justify-center overflow-hidden bg-white/40 dark:bg-black/40",children:e.jsx(S,{image:t.image,alt:t.name,className:"w-full h-full object-contain pointer-events-none text-4xl"})}),e.jsxs("div",{className:"flex flex-col p-3 flex-grow bg-white/10 dark:bg-transparent",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-800 dark:text-slate-200 truncate",children:t.name}),e.jsx("p",{className:"mt-0.5 font-display text-lg text-amber-600 dark:text-amber-400 font-bold",children:i}),e.jsxs("div",{className:"mt-auto flex-grow flex items-end justify-between",children:[e.jsx("p",{className:`text-xs font-semibold ${r?"text-slate-500 dark:text-slate-400":"text-red-500 dark:text-red-300"}`,children:r?`Stock: ${t.stock}`:"Rupture"}),e.jsx("div",{className:`px-3 py-1 text-xs font-bold rounded-full shadow-sm transition-all duration-200 border
            ${r?"border-amber-500 text-amber-600 dark:text-amber-500":"border-slate-400 text-slate-500"}`,children:"Ajouter"})]})]}),!r&&e.jsx("div",{className:"absolute inset-0 bg-white/60 dark:bg-black/60 backdrop-blur-[1px] pointer-events-none","aria-hidden":"true"})]})}),_=s.memo(({product:t})=>{const{addToCart:d,settings:a}=j(),l=t.stock>0,c=()=>{l&&d(t)},r=a.tokenMode?`${t.tokenPrice||0} Jeton${(t.tokenPrice||0)>1?"s":""}`:`${v(t.price)}`;return e.jsxs("button",{onClick:c,disabled:!l,className:`glass-panel w-full flex flex-col items-center p-3 rounded-2xl shadow-xl shadow-amber-500/10 transition-all duration-300
            ${l?"hover:scale-105":"border-red-500/50 opacity-60"}
            focus:outline-none focus:ring-2 focus:ring-amber-500`,"aria-label":l?`Ajouter ${t.name} au panier`:`${t.name} en rupture de stock`,children:[e.jsx("div",{className:"w-24 h-24 rounded-lg flex items-center justify-center overflow-hidden bg-white/40 dark:bg-black/40 mb-2",children:e.jsx(S,{image:t.image,alt:t.name,className:"w-full h-full object-contain text-4xl"})}),e.jsx("h3",{className:"text-sm font-bold text-slate-800 dark:text-slate-200 text-center truncate w-full",children:t.name}),e.jsx("p",{className:"font-display text-lg text-amber-600 dark:text-amber-400 font-bold",children:r}),e.jsx("p",{className:`text-xs font-semibold ${l?"text-slate-500 dark:text-slate-400":"text-red-500 dark:text-red-300"}`,children:l?`Stock: ${t.stock}`:"Rupture"})]})}),O=({products:t})=>{const{addToCart:d}=j(),a=s.useRef(null),l=s.useRef(0),c=s.useRef(!1),r=s.useRef(!1),i=s.useRef(0),u=s.useRef(0),h=t.length>w?t.slice(0,w):t;s.useEffect(()=>{a.current&&(a.current.style.transition="transform 0.5s ease-out",a.current.style.transform="rotateY(0deg)",l.current=0)},[t]);const p=s.useCallback(o=>{c.current=!0,r.current=!1,i.current=o,u.current=l.current,a.current&&(a.current.style.transition="none")},[]),b=s.useCallback(o=>{if(!c.current)return;const f=.4,N=o-i.current;Math.abs(N)>5&&(r.current=!0);const y=u.current+N*f;requestAnimationFrame(G=>{a.current&&(a.current.style.transform=`rotateY(${y}deg)`)})},[]),n=s.useCallback(()=>{if(c.current){if(c.current=!1,a.current){const o=a.current.style.transform,f=/rotateY\(([^d]+)deg\)/.exec(o);f&&f[1]&&(l.current=parseFloat(f[1])),a.current.style.transition="transform 0.5s ease-out"}setTimeout(()=>{r.current=!1},0)}},[]),g=o=>p(o.clientX),k=o=>b(o.clientX),x=()=>n(),m=()=>{c.current&&n()},M=o=>p(o.touches[0].clientX),R=o=>b(o.touches[0].clientX),P=()=>n(),$=250,T=h.length>0?360/h.length:0,D=s.useCallback(o=>f=>{if(r.current){f.stopPropagation();return}o.stock>0&&d(o)},[d]);return e.jsxs("div",{className:"flex-grow flex items-center justify-center cursor-grab active:cursor-grabbing relative",style:{perspective:"1000px"},onMouseDown:g,onMouseMove:k,onMouseUp:x,onMouseLeave:m,onTouchStart:M,onTouchMove:R,onTouchEnd:P,role:"region","aria-roledescription":"carousel","aria-label":"Carousel de produits",children:[e.jsx("div",{id:"product-carousel",ref:a,className:"relative w-40 h-52",style:{transformStyle:"preserve-3d",transform:"rotateY(0deg)",transition:"transform 0.5s ease-out"},children:h.map((o,f)=>{const y={transform:`rotateY(${T*f}deg) translateZ(${$}px)`};return e.jsx(X,{product:o,style:y,onClick:D(o)},o.id)})}),t.length>w&&e.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-xs text-slate-400 bg-black/50 px-3 py-1 rounded-full pointer-events-none",children:[w," premiers produits affichÃ©s."]})]})},Y=({products:t})=>{const[d,a]=s.useState(C),l=s.useRef(null),c=s.useCallback(i=>{l.current&&l.current.disconnect(),l.current=new IntersectionObserver(u=>{u[0].isIntersecting&&a(h=>Math.min(h+C,t.length))}),i&&l.current.observe(i)},[t.length]);s.useEffect(()=>{a(C)},[t]);const r=s.useMemo(()=>t.slice(0,d),[t,d]);return e.jsxs("div",{className:"flex-grow overflow-y-auto",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4",children:r.map(i=>e.jsx(_,{product:i},i.id))}),d<t.length&&e.jsx("div",{ref:c,className:"h-20 flex items-center justify-center",children:e.jsxs("svg",{className:"animate-spin h-8 w-8 text-amber-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})})]})},B=()=>{const{products:t,settings:d}=j(),[a,l]=s.useState(""),c=V(a,300),[r,i]=s.useState("all"),[u,h]=s.useState(!1),p=["all",...d.categories],b=s.useMemo(()=>t.filter(n=>{const g=r==="all"||n.category===r,k=n.name.toLowerCase().includes(c.toLowerCase());return g&&k}),[t,r,c]);return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsx("h1",{className:"text-4xl font-display text-center flex-shrink-0 text-amber-500 dark:text-amber-400 mb-4 drop-shadow-sm",children:"Faire une Vente"}),e.jsxs("div",{className:"sticky top-0 z-10 py-2 space-y-4 mb-4 backdrop-blur-md bg-white/10 dark:bg-black/20 rounded-xl px-2",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("label",{htmlFor:"search-product",className:"sr-only",children:"Rechercher un produit"}),e.jsx("input",{id:"search-product",type:"search",placeholder:"Rechercher un produit...",value:a,onChange:n=>l(n.target.value),className:"w-full pl-12 pr-12 py-3 bg-white/40 dark:bg-black/40 text-slate-900 dark:text-white border-2 border-white/20 focus:border-amber-500 rounded-xl shadow-sm transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-amber-500/50 placeholder-slate-500 dark:placeholder-slate-400"}),e.jsx("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 dark:text-slate-400 pointer-events-none","aria-hidden":"true",children:e.jsx(E,{className:"w-6 h-6"})}),a&&e.jsx("button",{onClick:()=>l(""),className:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-500 hover:text-slate-800 dark:hover:text-white p-1 rounded-full transition-colors","aria-label":"Effacer la recherche",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"flex space-x-3 overflow-x-auto pb-2 -mx-2 px-2 no-scrollbar",children:p.map(n=>e.jsx("button",{onClick:()=>i(n),className:`px-4 py-2 text-sm font-bold rounded-full transition-all duration-200 whitespace-nowrap shadow-md border-2
                          ${r===n?"bg-amber-500 text-black border-amber-500 scale-105":"bg-white/40 dark:bg-[#2a2a2a] text-slate-700 dark:text-slate-300 hover:bg-white/60 dark:hover:bg-[#3a3a3a] border-slate-300 dark:border-slate-700"}`,children:n==="all"?"Tous":n},n))})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{onClick:()=>h(!0),className:"w-full flex items-center justify-center gap-2 bg-white/20 dark:bg-transparent text-amber-600 dark:text-amber-400 border-2 border-amber-500/50 dark:border-amber-400 font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-500/20 transition-all transform hover:scale-105 font-display text-lg",children:[e.jsx(I,{className:"w-6 h-6"}),"+ Vente Diverse"]})})]}),e.jsx("div",{className:"flex-grow flex flex-col min-h-0",children:b.length>0?d.uiMode==="grid"?e.jsx(Y,{products:b}):e.jsx(O,{products:b}):e.jsx("div",{className:"flex-grow flex items-center justify-center text-center py-10 px-4 text-slate-500 dark:text-slate-400 glass-panel rounded-xl",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-4xl",children:"ðŸ˜¥"}),e.jsx("p",{className:"text-2xl font-display text-slate-700 dark:text-slate-300 mt-2",children:"Oups !"}),e.jsx("p",{className:"mt-2",children:"Aucun produit ne correspond Ã  votre recherche."})]})})}),e.jsx(z,{isOpen:u,onClose:()=>h(!1)})]})},q=A.memo(B);export{q as default};

import{r as n,P as H,j as e,i as be,B as fe,D as ge,F as je,Q as Y}from"./Icons-C56Ecv4l.js";import{u as R,b as Ne,P as ye,M as X}from"./main-fTa5Vs1T.js";import{N as _}from"./NumericKeypad-CSJS3737.js";import{C as we}from"./ConfirmModal-nmoTI0Hj.js";import{E as ke,a as ve}from"./jspdf.plugin.autotable-JPd6pWbp.js";const Ce=n.memo(({transaction:p,onNewSale:b,onGenerateReceipt:a})=>{const{settings:f}=R(),{sale:l,cashReceived:g}=p,j=(g??0)-l.total;return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[e.jsx("div",{className:"text-8xl",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-24 w-24 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("h1",{className:"text-4xl font-display text-amber-400 mt-4",children:["Vente de ",l.total.toFixed(2),"â‚¬ ComplÃ¨te !"]}),l.customerName&&e.jsxs("p",{className:"text-slate-300 mt-2 text-lg",children:["Client: ",l.customerName]}),l.paymentMethod==="cash"&&g!==void 0&&e.jsxs("div",{className:"mt-4 text-center p-4 bg-emerald-900/50 rounded-lg border border-emerald-700 w-full max-w-xs space-y-2",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["Montant reÃ§u : ",g.toFixed(2),"â‚¬"]}),j>=0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xl text-emerald-300",children:"Monnaie Ã  rendre :"}),e.jsxs("p",{className:"text-4xl font-display text-emerald-200",children:[j.toFixed(2),"â‚¬"]})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 w-full max-w-sm",children:[f.businessName&&e.jsx("button",{onClick:()=>a(l),className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:"GÃ©nÃ©rer Ticket"}),e.jsx("button",{onClick:b,className:"w-full bg-slate-600 text-slate-200 font-bold py-3 px-6 rounded-full shadow-lg hover:bg-slate-700 transition-colors font-display text-lg",children:"Nouvelle Vente"})]})]})}),Se=n.memo(({isOpen:p,onClose:b,item:a})=>{const{updateCartQuantity:f,products:l,showToast:g}=R(),[j,y]=n.useState(""),E=n.useMemo(()=>a?l.find(o=>o.id===a.id):null,[l,a]),w=a?.isMisc?1/0:E?.stock??0;n.useEffect(()=>{a&&y(String(a.quantity))},[a]);const C=()=>{const o=parseInt(j,10);a&&!isNaN(o)&&(o>w?(g(`Stock insuffisant. ${w} disponible(s).`,"error"),f(a.id,w)):f(a.id,o)),b()},c=o=>{o!=="."&&y(S=>S==="0"?o:S+o)},N=()=>{y(o=>o.length>1?o.slice(0,-1):"0")};return a?e.jsx(X,{isOpen:p,onClose:b,title:"Modifier QuantitÃ©",children:e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-xl text-slate-200 font-display",children:a.name}),!a.isMisc&&e.jsxs("p",{className:"text-sm text-slate-400",children:["Stock disponible : ",w]}),e.jsx("input",{type:"text",readOnly:!0,value:j,className:"block w-full text-center text-4xl p-2 border-white/20 rounded-md shadow-sm bg-[#1a1a1a] text-white font-sans"}),e.jsx(_,{onKeyPress:c,onDelete:N,onDone:C})]})}):null}),Me=({setPage:p})=>{const{cart:b,cartTotal:a,cartTokenTotal:f,settings:l,cartCount:g,removeFromCart:j,processSale:y,clearCart:E}=R(),[w,C]=n.useState(!1),[c,N]=n.useState(""),[o,S]=n.useState(!1),[V,O]=n.useState(null),[Z,P]=n.useState(!1),[ee,q]=n.useState(!1),[B,K]=n.useState(null),[W,A]=n.useState(!1),[L,Q]=n.useState(""),U=n.useCallback((t,s)=>{A(!1);const M=y(t,L);O({sale:M,cashReceived:s}),S(!0),t==="cash"&&(C(!1),P(!1),N(""))},[y,L]),te=()=>{U("cash",Number(c))},k=t=>{U(t)},se=n.useCallback(async t=>{const s=new ke,{businessName:M,businessAddress:$,businessContact:I,receiptFooter:v,businessLogo:x}=l,me=s.internal.pageSize.getHeight(),m=s.internal.pageSize.getWidth(),d=14;let r=20;if(x)try{let i="";if(x instanceof Blob?i=await Ne(x):typeof x=="string"&&x.startsWith("data:")&&(i=x),i){const u=new Image;u.src=i,await new Promise(G=>{u.onload=G,u.onerror=G});const D=15,F=u.width*D/u.height,pe=m/2-F/2;s.addImage(i,"PNG",pe,15,F,D),r=35}}catch(i){console.error("Could not add logo to receipt:",i)}s.setFont("helvetica","bold"),s.setFontSize(20),s.text(M||"Buvette",m/2,r,{align:"center"}),r+=8,s.setFont("helvetica","normal"),s.setFontSize(10),$&&(s.text($,m/2,r,{align:"center"}),r+=5),I&&(s.text(I,m/2,r,{align:"center"}),r+=5),r+=10,s.setFont("helvetica","bold"),s.setFontSize(12),s.text("Ticket de Caisse",d,r),s.setFont("helvetica","normal"),s.setFontSize(10),s.text(`Transaction : #${t.id.slice(-6)}`,d,r+7),s.text(`Date : ${new Date(t.date).toLocaleString("fr-FR")}`,d,r+12),t.customerName&&(s.text(`Client : ${t.customerName}`,d,r+17),r+=5);const he=["Produit","QtÃ©","P.U.","Total"],J=[];t.items.forEach(i=>{const u=l.tokenMode?i.tokenPrice||0:i.price,D=u*i.quantity,F=l.tokenMode?" J":"â‚¬";J.push([i.name,i.quantity,`${u.toFixed(l.tokenMode?0:2)}${F}`,`${D.toFixed(l.tokenMode?0:2)}${F}`])}),ve(s,{head:[he],body:J,startY:r+20,theme:"plain",headStyles:{fontStyle:"bold",fillColor:!1,textColor:20},styles:{fontSize:10},columnStyles:{0:{cellWidth:"auto"},1:{cellWidth:20,halign:"center"},2:{cellWidth:30,halign:"right"},3:{cellWidth:30,halign:"right"}}});const z=s.lastAutoTable.finalY||120;s.setDrawColor(180),s.line(d,z+6,m-d,z+6),s.setFontSize(16),s.setFont("helvetica","bold");const ue=`TOTAL : ${l.tokenMode?`${t.total} Jeton${t.total>1?"s":""}`:`${t.total.toFixed(2)}â‚¬`}`;s.text(ue,m-d,z+15,{align:"right"});let h="";switch(t.paymentMethod){case"card":h="Carte Bancaire";break;case"token":h="Jetons";break;case"cash":h="EspÃ¨ces";break;case"check":h="ChÃ¨que";break;case"paypal":h="PayPal";break;case"wero":h="Wero";break;default:h="Autre";break}s.setFontSize(10),s.setFont("helvetica","normal"),s.text(`PayÃ© par : ${h}`,d,z+15),v&&(s.setFontSize(9),s.setTextColor(100),s.text(v,m/2,me-15,{align:"center",maxWidth:m-d*2})),s.save(`ticket-${t.id}.pdf`)},[l]),ae=n.useCallback(()=>{S(!1),O(null),Q(""),p(H.Sale)},[p]),le=t=>{t==="."&&c.includes(".")||N(s=>s+t)},ne=()=>{N(t=>t.slice(0,-1))},oe=t=>{if(t<=5)return[5,10,20];if(t<=10)return[10,20,50];if(t<=20)return[20,50,100];const s=Math.ceil(t/5)*5,M=Math.ceil(t/10)*10,$=Math.ceil(t/20)*20,I=[s,M,$].filter(v=>v>t);return[...new Set(I)].sort((v,x)=>v-x).slice(0,3)},re=n.useMemo(()=>oe(a),[a]),T=Number(c)-a,ie=a*.0175,ce=a-ie,de=a>0?a*.029+.35:0,xe=Math.max(0,a-de);return o&&V?e.jsx(Ce,{transaction:V,onNewSale:ae,onGenerateReceipt:se}):b.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"text-7xl",children:"ðŸ›’"}),e.jsx("h1",{className:"text-3xl font-display text-slate-200 mt-4",children:"Panier Vide"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Ajoutez des produits depuis la page de vente."}),e.jsx("button",{onClick:()=>p(H.Sale),className:"mt-6 bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-transform font-display text-lg",children:"Parcourir les produits"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-4xl font-display text-amber-400",children:["Panier (",g,")"]}),e.jsx("button",{onClick:()=>A(!W),className:"font-bold text-amber-400 px-4 py-2 rounded-lg transition-colors hover:bg-white/10",children:W?"TerminÃ©":"Modifier"})]}),e.jsxs("div",{className:"space-y-3",children:[b.map(t=>e.jsxs("div",{className:"glass-panel p-3 rounded-xl shadow-sm border border-white/10 flex items-center gap-3",children:[W&&e.jsx("button",{onClick:()=>j(t.id),className:"text-red-300 hover:text-red-200 animate-in fade-in-0 zoom-in-90","aria-label":`Supprimer ${t.name}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex items-center space-x-4 flex-grow",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-white/20 dark:bg-black/20 flex items-center justify-center flex-shrink-0 border border-white/10",children:e.jsx(ye,{image:t.image,alt:t.name,className:"w-full h-full object-contain text-3xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200",children:t.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:l.tokenMode?`${t.tokenPrice||0} Jeton(s)`:`${t.price.toFixed(2)}â‚¬`})]})]}),e.jsx("button",{onClick:()=>K(t),className:"px-5 py-3 text-slate-800 dark:text-slate-200 font-semibold text-lg border border-slate-300 dark:border-white/20 rounded-lg transition-colors hover:bg-white/20 min-w-[60px] text-center","aria-label":`Modifier la quantitÃ© pour ${t.name}, actuellement ${t.quantity}`,children:t.quantity})]},t.id)),e.jsx("div",{className:"flex justify-end items-center pt-4 border-t border-white/10 mt-4",children:e.jsx("button",{onClick:()=>q(!0),className:"text-sm text-slate-500 hover:text-red-500 transition-colors",children:"Vider le panier"})})]}),e.jsxs("div",{className:"mt-6 p-5 glass-panel rounded-2xl shadow-lg border-2 border-amber-500/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-2xl font-display text-slate-800 dark:text-slate-200",children:"Total:"}),l.tokenMode?e.jsxs("span",{className:"text-3xl font-display text-amber-600 dark:text-amber-300",children:[f," Jeton",f>1?"s":""]}):e.jsxs("span",{className:"text-3xl font-display text-amber-600 dark:text-amber-300",children:[a.toFixed(2),"â‚¬"]})]}),!l.tokenMode&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-300/20 dark:border-white/10 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Net si paiement CB (SumUp) :"}),e.jsxs("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:[ce.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Net si paiement PayPal :"}),e.jsxs("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:[xe.toFixed(2),"â‚¬"]})]})]})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",children:e.jsx(be,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",value:L,onChange:t=>Q(t.target.value),placeholder:"Nom du client (optionnel)",className:"w-full p-3 pl-10 bg-white/20 dark:bg-[#1a1a1a] border border-white/20 text-slate-900 dark:text-white rounded-xl shadow-sm focus:ring-amber-500 focus:border-amber-500 transition placeholder-slate-500 dark:placeholder-slate-400"})]}),l.tokenMode?e.jsx("button",{onClick:()=>k("token"),className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:"Valider l'Ã©change"}):e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>C(!0),className:"col-span-1 flex items-center justify-center bg-white/10 dark:bg-transparent text-amber-600 dark:text-amber-400 border-2 border-amber-500 dark:border-amber-400 font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-amber-500/10 transition-all transform hover:scale-105 font-display text-lg",children:[e.jsx(fe,{className:"w-6 h-6 mr-2"}),"EspÃ¨ces"]}),e.jsxs("button",{onClick:()=>k("card"),className:"col-span-1 flex items-center justify-center bg-amber-500 text-black font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:[e.jsx(ge,{className:"w-6 h-6 mr-2"}),"Carte"]}),e.jsxs("button",{onClick:()=>k("check"),className:"flex flex-col items-center justify-center bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-bold py-2 px-2 rounded-xl shadow hover:opacity-90 transition-all",children:[e.jsx(je,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"ChÃ¨que"})]}),e.jsxs("button",{onClick:()=>k("paypal"),className:"flex flex-col items-center justify-center bg-[#003087] text-white font-bold py-2 px-2 rounded-xl shadow hover:opacity-90 transition-all",children:[e.jsx(Y,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"PayPal"})]}),e.jsxs("button",{onClick:()=>k("wero"),className:"col-span-2 flex items-center justify-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-xl shadow hover:opacity-90 transition-all",children:[e.jsx(Y,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Wero (Virement InstantanÃ©)"})]})]}),!l.tokenMode&&l.appMode==="association"&&e.jsx("div",{className:"pt-2 text-center",children:e.jsx("button",{onClick:()=>k("token"),className:"text-amber-500 hover:text-amber-400 text-sm font-bold underline decoration-dotted",children:"Payer en Jetons"})})]}),e.jsx(X,{isOpen:w,onClose:()=>{C(!1),P(!1)},title:"Paiement EspÃ¨ces",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-center text-lg text-slate-200",children:["Total Ã  payer: ",e.jsxs("span",{className:"font-bold text-2xl font-display text-amber-400",children:[a.toFixed(2),"â‚¬"]})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsx("button",{onClick:()=>N(a.toFixed(2)),className:"py-2 px-3 text-sm font-bold bg-white/10 rounded-lg hover:bg-white/20 transition-colors",children:"Exact"}),re.map(t=>e.jsxs("button",{onClick:()=>N(String(t)),className:"py-2 px-3 text-sm font-bold bg-white/10 rounded-lg hover:bg-white/20 transition-colors",children:[t,"â‚¬"]},t))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cash",className:"block text-sm font-medium text-slate-300 mb-2 text-center",children:"Montant reÃ§u"}),e.jsx("input",{type:"text",id:"cash",readOnly:!0,value:c,onFocus:()=>P(!0),placeholder:"0.00",className:"block w-full text-center text-3xl p-3 border-2 border-white/20 rounded-xl shadow-sm focus:ring-amber-500 focus:border-amber-500 bg-[#1a1a1a] text-white cursor-pointer font-sans"})]}),c&&T>=0&&e.jsxs("div",{className:"text-center p-3 bg-emerald-900/50 rounded-lg border border-emerald-700",children:[e.jsx("p",{className:"text-lg text-emerald-300",children:"Monnaie Ã  rendre:"}),e.jsxs("p",{className:"text-3xl font-display text-emerald-300",children:[T.toFixed(2),"â‚¬"]})]}),c&&T<0&&e.jsx("div",{className:"text-center p-3 bg-red-900/50 rounded-lg border border-red-700",children:e.jsx("p",{className:"text-lg text-red-300",children:"Montant insuffisant"})}),Z?e.jsx(_,{onKeyPress:le,onDelete:ne,onDone:()=>P(!1)}):e.jsx("button",{onClick:te,disabled:!c||T<0,className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg disabled:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirmer Vente"})]})}),e.jsx(we,{isOpen:ee,onClose:()=>q(!1),onConfirm:E,title:"Vider le panier",message:"ÃŠtes-vous sÃ»r de vouloir supprimer tous les articles du panier ? Cette action est irrÃ©versible.",confirmText:"Vider"}),e.jsx(Se,{isOpen:!!B,onClose:()=>K(null),item:B})]})},De=n.memo(Me);export{De as default};

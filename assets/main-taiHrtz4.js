const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HomePage-DdZNqTlw.js","assets/Icons-C56Ecv4l.js","assets/useEventAnalytics-CvWWVUE_.js","assets/formatting-B5pXF3od.js","assets/SalePage-rJu9rpnZ.js","assets/NumericKeypad-CSJS3737.js","assets/useDebounce-7V9QMTWI.js","assets/CartPage-0x5s8n4Z.js","assets/ConfirmModal-BbqZglWu.js","assets/jspdf.plugin.autotable-tp6HpGff.js","assets/StockPage-B6KncZjR.js","assets/StatsPage-D1gTc7Vx.js","assets/MorePage-MVg_sD_z.js","assets/PremiumLockModal-BOcxjjoK.js","assets/SettingsPage-AUaPCV1i.js","assets/DonationsPage-Cbw1dU5w.js","assets/ResetPage-CiA6Zx7_.js","assets/IdeasPage-DGZNXJ-q.js","assets/index-dXEpzMxB.js","assets/UpgradePage-CGrnPdFQ.js","assets/BackupPage-B3Jnafz4.js","assets/TutorialPage-DybEButx.js","assets/CashOutPage-BXWWuCjn.js","assets/TeamPage-D9wsV8FI.js","assets/TermsOfUsePage-BlYqgwlN.js"])))=>i.map(i=>d[i]);
import{r as t,S as ee,o as st,U as at,v as rt,j as e,l as nt,s as ot,a as lt,H as it,P as y,b as ct,A as dt,C as ut,E as mt,R as B,L as te,K as xt,c as X,W as ht,d as Z,e as Q,f as ce,g as de,h as ft,i as pt,k as bt,m as gt}from"./Icons-C56Ecv4l.js";const vt="modulepreload",wt=function(s){return"/KAYE/"+s},se={},T=function(o,i,r){let x=Promise.resolve();if(i&&i.length>0){let v=function(p){return Promise.all(p.map(b=>Promise.resolve(b).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");x=v(i.map(p=>{if(p=wt(p),p in se)return;se[p]=!0;const b=p.endsWith(".css"),h=b?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${h}`))return;const d=document.createElement("link");if(d.rel=b?"stylesheet":vt,b||(d.as="script"),d.crossOrigin="",d.href=p,c&&d.setAttribute("nonce",c),document.head.appendChild(d),b)return new Promise((w,g)=>{d.addEventListener("load",w),d.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${p}`)))})}))}function m(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return x.then(l=>{for(const c of l||[])c.status==="rejected"&&m(c.reason);return o().catch(m)})};function jt(s,o){const[i,r]=t.useState(()=>{if(typeof window>"u")return o;try{const m=window.localStorage.getItem(s);return m?JSON.parse(m):o}catch(m){return console.error(m),o}}),x=m=>{try{const l=m instanceof Function?m(i):m;r(l),typeof window<"u"&&window.localStorage.setItem(s,JSON.stringify(l))}catch(l){console.error(l)}};return t.useEffect(()=>{const m=l=>{l.storageArea===window.localStorage&&l.key===s&&l.newValue&&r(JSON.parse(l.newValue))};return window.addEventListener("storage",m),()=>{window.removeEventListener("storage",m)}},[s]),[i,x]}const yt="BuvettePlusDB",St=1,q="userData",ue=()=>new Promise((s,o)=>{const i=indexedDB.open(yt,St);i.onerror=r=>{console.error("IndexedDB error:",r),o("Impossible d'ouvrir la base de donn√©es locale.")},i.onsuccess=r=>{s(r.target.result)},i.onupgradeneeded=r=>{const x=r.target.result;x.objectStoreNames.contains(q)||x.createObjectStore(q)}}),ae=async(s,o)=>{const i=await ue();return new Promise((r,x)=>{const c=i.transaction([q],"readwrite").objectStore(q).put(o,s);c.onsuccess=()=>r(),c.onerror=()=>x("Erreur lors de la sauvegarde des donn√©es.")})},Nt=async s=>{const o=await ue();return new Promise((i,r)=>{const l=o.transaction([q],"readonly").objectStore(q).get(s);l.onsuccess=()=>i(l.result||null),l.onerror=()=>r("Erreur lors du chargement des donn√©es.")})},me=s=>btoa(unescape(encodeURIComponent(s))),K=s=>`b64|${me(s)}`,re=(s,o)=>o===`b64|${me(s)}`,V={businessName:"KAY√â",businessAddress:"",businessContact:"",receiptFooter:"Merci de votre visite !",businessLogo:null,backgroundImage:null,backgroundOverlayOpacity:.7,appFont:"modern",startupGif:null,adminPassword:K("admin"),initialCash:0,lowStockThreshold:5,tokenMode:!1,appMode:"business",uiMode:"carousel",subscriptionPlan:ee.ESSENTIEL,subscriptionExpiry:null,team:[],brandColor:"#2563eb",categories:["Divers","Boissons","Snacks"],themeMode:"dark",urssafActivity:"vente",urssafRate:12.3,hourlyRate:11.65},xe=t.createContext(void 0),kt=({children:s})=>{const[o,i]=t.useState(null),[r,x]=t.useState(!0),[m,l]=t.useState([]),[c,v]=t.useState(V),[p,b]=t.useState([]),[h,d]=t.useState([]),[w,g]=t.useState([]),[S,N]=t.useState([]),[k,C]=t.useState([]),[D,U]=t.useState([]),[P,j]=t.useState([]),[A,L]=t.useState([]),[H,O]=t.useState(!1),[be,z]=t.useState(null),[ge,F]=jt("buv-justActivated",!1),ve=t.useCallback(n=>{L(a=>a.filter(u=>u.id!==n))},[]),I=t.useCallback((n,a="success")=>{const u={id:Date.now(),message:n,type:a};L(f=>[...f,u])},[]);t.useEffect(()=>{const n=st(a=>{i(a?{id:a.uid,email:a.email}:null),a||x(!1)});return()=>n()},[]),t.useEffect(()=>{(async()=>{if(o)try{let a=await Nt(o.id);if(!a){const u=`buv-data-${o.id}`,f=localStorage.getItem(u);if(f)try{a=JSON.parse(f),a&&await ae(o.id,a)}catch(E){console.error("Migration from LocalStorage failed",E)}}if(a){l(a.products||[]);const u=a.settings?{...V,...a.settings}:V;try{if(u.hourlyRate===void 0||u.hourlyRate===null){const f=localStorage.getItem("buvette-hourlyRate");if(f){const E=parseFloat(f);isNaN(E)||(u.hourlyRate=E)}}}catch{}(!u.categories||u.categories.length===0)&&(u.categories=V.categories),v(u),b(a.sales||[]),d(a.donations||[]),g(a.manualRefunds||[]),N(a.safeDeposits||[]),C(a.stockHistory||[]),U(a.cashOuts||[])}else l([]),v(V),b([]),d([]),g([]),N([]),C([]),U([])}catch(a){console.error("Failed to load user data from IndexedDB.",a),I("Erreur de chargement des donn√©es locales.","error")}else l([]),v(V),b([]),d([]),g([]),N([]),C([]),U([]),O(!1),z(null);x(!1)})()},[o,I]),t.useEffect(()=>{if(o&&!r){const a=setTimeout(async()=>{try{const u={products:m,settings:c,sales:p,donations:h,manualRefunds:w,safeDeposits:S,stockHistory:k,cashOuts:D};await ae(o.id,u)}catch(u){console.error("Failed to save data to IndexedDB",u)}},1e3);return()=>clearTimeout(a)}},[o,r,m,c,p,h,w,S,k,D]);const we=t.useCallback(n=>{const a={...n,id:crypto.randomUUID()};if(l(u=>[...u,a]),a.stock>0){const u={id:crypto.randomUUID(),date:new Date().toISOString(),productId:a.id,productName:a.name,type:"initial",quantityChange:a.stock,newStock:a.stock,note:"Cr√©ation du produit"};C(f=>[...f,u])}},[]),je=t.useCallback(n=>{l(a=>a.map(u=>u.id===n.id?n:u))},[]),ye=t.useCallback(n=>{l(a=>a.filter(u=>u.id!==n))},[]),Se=t.useCallback(n=>{const a={...n,id:crypto.randomUUID(),date:new Date().toISOString()};C(u=>[a,...u])},[]),Ne=t.useCallback(n=>{if(n.stock<=0){I("Produit en rupture de stock","error");return}j(a=>{const u=a.find(f=>f.id===n.id);return u?u.quantity>=n.stock?(I("Stock insuffisant","error"),a):a.map(f=>f.id===n.id?{...f,quantity:f.quantity+1}:f):[...a,{...n,quantity:1}]})},[I]),ke=t.useCallback((n,a)=>{const u={id:`misc-${Date.now()}`,name:a,price:n,quantity:1,image:"üè∑Ô∏è",isMisc:!0,category:"Divers"};j(f=>[...f,u])},[]),J=t.useCallback(n=>{j(a=>a.filter(u=>u.id!==n))},[]),Ce=t.useCallback((n,a)=>{if(a<=0){J(n);return}j(u=>u.map(f=>f.id===n?{...f,quantity:a}:f))},[J]),Ee=t.useCallback(()=>j([]),[]),Ie=t.useCallback((n,a)=>{const u=P.reduce((_,M)=>{const $=c.tokenMode?M.tokenPrice||0:M.price;return _+$*M.quantity},0),f={id:crypto.randomUUID(),date:new Date().toISOString(),items:[...P],total:u,paymentMethod:n,customerName:a};b(_=>[f,..._]);const E=new Map;return P.forEach(_=>{_.isMisc||E.set(_.id,_.quantity)}),l(_=>_.map(M=>{const $=E.get(M.id);if($){const W=Math.max(0,M.stock-$),et={id:crypto.randomUUID(),date:new Date().toISOString(),productId:M.id,productName:M.name,type:"sale",quantityChange:-$,newStock:W,note:`Vente #${f.id.slice(-6)}`};return C(tt=>[et,...tt]),{...M,stock:W}}return M})),j([]),f},[P,c.tokenMode]),De=t.useCallback(n=>{const a=p.find(f=>f.id===n);if(!a)return;const u=new Map;a.items.forEach(f=>{f.isMisc||u.set(f.id,f.quantity)}),l(f=>f.map(E=>{const _=u.get(E.id);if(_){const M=E.stock+_,$={id:crypto.randomUUID(),date:new Date().toISOString(),productId:E.id,productName:E.name,type:"refund",quantityChange:_,newStock:M,note:`Annulation vente #${a.id.slice(-6)}`};return C(W=>[$,...W]),{...E,stock:M}}return E})),b(f=>f.filter(E=>E.id!==n)),I("Vente annul√©e et stock restaur√©.","success")},[p,I]),Pe=t.useCallback((n,a,u,f="cash")=>{const E={id:crypto.randomUUID(),date:new Date().toISOString(),amount:n,name:a||"Anonyme",note:u,paymentMethod:f};d(_=>[E,..._]),I(`Don de ${n}‚Ç¨ ajout√© !`,"success")},[I]),Te=t.useCallback((n,a)=>{const u={id:crypto.randomUUID(),date:new Date().toISOString(),amount:n,reason:a};g(f=>[u,...f])},[]),Ae=t.useCallback((n,a)=>{const u={id:crypto.randomUUID(),date:new Date().toISOString(),amount:n,note:a};N(f=>[u,...f]),I(`D√©p√¥t au coffre de ${n}‚Ç¨ enregistr√©.`,"success")},[I]),_e=t.useCallback((n,a,u)=>{const f={id:crypto.randomUUID(),date:new Date().toISOString(),amount:n,reason:a,receiptImage:u};U(E=>[f,...E]),I(`Sortie d'esp√®ces de ${n}‚Ç¨ enregistr√©e.`,"success")},[I]),Ue=t.useCallback(()=>{b([]),d([]),g([]),N([]),C([]),U([]),I("Nouvel √©v√©nement d√©marr√©. Les historiques ont √©t√© r√©initialis√©s.")},[I]),Le=async(n,a)=>await lt(n,a),Me=async(n,a)=>await ot(n,a),Re=()=>{nt(),z(null),O(!1)},Oe=t.useCallback(n=>{const a=K(n);v(u=>({...u,adminPassword:a}))},[]),$e=t.useCallback(n=>{if(!n||!n.settings)return!1;try{return l(n.products||[]),v(n.settings),b(n.sales||[]),d(n.donations||[]),g(n.manualRefunds||[]),N(n.safeDeposits||[]),C(n.stockHistory||[]),U(n.cashOuts||[]),I("Donn√©es restaur√©es avec succ√®s !","success"),!0}catch{return!1}},[I]),Be=t.useCallback(n=>!c.adminPassword&&n==="admin"?(O(!0),z({type:"admin"}),{success:!0,message:"Bienvenue Admin"}):re(n,c.adminPassword||K("admin"))?(O(!0),z({type:"admin"}),{success:!0,message:"Bienvenue Admin"}):{success:!1,message:"Mot de passe incorrect"},[c.adminPassword]),ze=t.useCallback((n,a)=>{const u=c.team.find(f=>f.id===n);return u?re(a,u.pinHash)?(O(!1),z({type:"team",user:u}),{success:!0,message:`Bienvenue ${u.name}`}):{success:!1,message:"Code PIN incorrect"}:{success:!1,message:"Utilisateur introuvable"}},[c.team]),Fe=t.useCallback(()=>{O(!1),z(null)},[]),Ve=t.useCallback((n,a)=>{const u={id:crypto.randomUUID(),name:n,role:at.Seller,pinHash:K(a)};v(f=>({...f,team:[...f.team,u]})),I(`Membre ${n} ajout√© !`,"success")},[I]),qe=t.useCallback((n,a,u)=>{v(f=>({...f,team:f.team.map(E=>E.id===n?{...E,name:a,pinHash:u?K(u):E.pinHash}:E)})),I(`Membre ${a} mis √† jour !`,"success")},[I]),He=t.useCallback(n=>{v(a=>({...a,team:a.team.filter(u=>u.id!==n)})),I("Membre supprim√©.","success")},[I]),Ke=t.useCallback(async n=>{if(!o)return{success:!1,message:"Vous devez √™tre connect√© pour activer une licence."};const a=await rt(n,o.id);if(a.success&&a.plan&&a.duration){const u=new Date;return u.setDate(u.getDate()+a.duration),v(f=>({...f,subscriptionPlan:a.plan,subscriptionExpiry:u.toISOString()})),F(!0),{success:!0}}return{success:!1,message:a.message}},[o,F]),We=t.useCallback(()=>{const n=new Date;n.setDate(n.getDate()+7),v(a=>({...a,subscriptionPlan:ee.PRO,subscriptionExpiry:n.toISOString()})),F(!0)},[F]),Xe=t.useCallback(()=>{F(!1)},[F]),Je=P.reduce((n,a)=>n+a.quantity,0),Ge=P.reduce((n,a)=>n+a.price*a.quantity,0),Ye=P.reduce((n,a)=>n+(a.tokenPrice||0)*a.quantity,0),Ze=t.useMemo(()=>{const n=c.appMode==="association";return{buvette:n?"Buvette":"Boutique",team:n?"B√©n√©voles":"√âquipe",donation:n?"Don":"Pourboire",event:n?"√âv√©nement":"Session",token:n?"Jeton":"Cr√©dit"}},[c.appMode]),Qe={products:m,settings:c,sales:p,donations:h,manualRefunds:w,safeDeposits:S,stockHistory:k,cart:P,cartCount:Je,cartTotal:Ge,cartTokenTotal:Ye,notifications:A,cashOuts:D,isAdmin:H,currentUser:o,justActivated:ge,subscriptionPlan:c.subscriptionPlan,activeSessionUser:be,labels:Ze,isAuthLoading:r,addProduct:we,updateProduct:je,deleteProduct:ye,setSettings:v,addToCart:Ne,addMiscSaleToCart:ke,removeFromCart:J,updateCartQuantity:Ce,clearCart:Ee,processSale:Ie,deleteSale:De,addDonation:Pe,addManualRefund:Te,addSafeDeposit:Ae,addCashOut:_e,startNewEvent:Ue,addStockHistoryEntry:Se,showToast:I,removeNotification:ve,activateApp:Ke,startTrial:We,clearJustActivatedFlag:Xe,registerUser:Le,loginUser:Me,logoutUser:Re,changeAdminPassword:Oe,restoreUserData:$e,loginAdmin:Be,loginTeamMember:ze,logoutSession:Fe,addTeamMember:Ve,updateTeamMember:qe,deleteTeamMember:He};return e.jsx(xe.Provider,{value:Qe,children:s})},R=()=>{const s=t.useContext(xe);if(s===void 0)throw new Error("useBuvette must be used within a BuvetteProvider");return s},Ct=[{page:y.Home,label:"Accueil",icon:it},{page:y.Sale,label:"Vente",icon:ct},{page:y.Stock,label:"Stock",icon:dt},{page:y.Stats,label:"Stats",icon:ut},{page:y.More,label:"Plus",icon:mt}],Et=[y.Stock,y.Stats,y.Settings,y.Donations,y.Reset,y.Upgrade,y.Backup,y.CashOut,y.Team],It=({currentPage:s,setPage:o})=>{const{cartCount:i,isAdmin:r,settings:x}=R(),m=x.brandColor||"#3b82f6";return e.jsx("footer",{className:"fixed bottom-0 left-0 right-0 bg-black/60 backdrop-blur-xl border-t border-white/10 z-50",children:e.jsx("nav",{className:"flex justify-around items-center h-20 safe-area-pb",children:Ct.map(({page:l,label:c,icon:v})=>{const p=l===y.Sale,b=p&&i>0?y.Cart:l,h=p&&i>0?"Panier":c,d=s===b,g=Et.includes(l)&&!r,S=d?"":"text-slate-400",N=d?{color:m}:{};return e.jsxs("button",{onClick:()=>o(b),className:"flex flex-col items-center justify-center w-full transition-transform duration-200 ease-in-out transform hover:scale-110 relative p-2","aria-label":h,children:[e.jsxs("div",{className:"relative",children:[g?e.jsx(te,{className:`w-7 h-7 ${S}`,style:N}):e.jsx(v,{className:`w-7 h-7 ${S} transition-all duration-300`,style:{...N,filter:d?`drop-shadow(0 0 8px ${m}80)`:"none"}}),p&&i>0&&e.jsx("span",{className:"absolute -top-2 -right-3 flex items-center justify-center w-5 h-5 text-xs font-bold text-black bg-orange-500 rounded-full shadow-sm",children:i}),d&&e.jsx("div",{className:"absolute -bottom-2.5 left-1/2 -translate-x-1/2 w-8 h-1 rounded-full",style:{backgroundColor:m,boxShadow:`0 0 10px ${m}`}})]}),e.jsx("span",{className:`text-[10px] mt-1 font-semibold tracking-wide uppercase ${S}`,style:N,children:h})]},l)})})})},Dt=B.memo(It),Pt=({notification:s,onClose:o})=>{const{id:i,message:r,type:x}=s,[m,l]=t.useState(!1),c=3e3,v=5e3,p=300,b=t.useRef(null),h=t.useRef(x==="success"?c:v),d=t.useRef(Date.now()),w=t.useCallback(()=>{l(!0)},[]),g=t.useCallback(()=>{if(b.current){clearTimeout(b.current);const j=Date.now()-d.current;h.current-=j}},[]),S=t.useCallback(()=>{d.current=Date.now(),b.current=window.setTimeout(w,h.current)},[w]);t.useEffect(()=>(S(),()=>{b.current&&clearTimeout(b.current)}),[S]),t.useEffect(()=>{if(m){const j=setTimeout(()=>{o(i)},p);return()=>clearTimeout(j)}},[m,o,i]);const N="pointer-events-auto w-full max-w-md px-4 py-3 text-white rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 border backdrop-blur-md";let k="",C;switch(x){case"success":k="bg-emerald-800/80 border-emerald-500",C=e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-emerald-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})});break;case"error":k="bg-red-800/80 border-red-500",C=e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-red-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})});break}const D=m?"animate-out fade-out slide-out-to-bottom":"animate-in fade-in slide-in-from-bottom-10",U=x==="success"?"status":"alert",P=x==="success"?"polite":"assertive";return e.jsxs("div",{onMouseEnter:g,onMouseLeave:S,className:`${N} ${k} ${D}`,role:U,"aria-live":P,children:[e.jsx("span",{className:"flex-shrink-0",children:C}),e.jsx("p",{className:"font-semibold text-slate-100 text-sm text-center flex-grow",children:r}),e.jsx("button",{onClick:w,"aria-label":"Fermer la notification",className:"ml-2 text-2xl leading-none opacity-70 hover:opacity-100 flex-shrink-0",children:"√ó"})]})},Tt=t.memo(Pt),At=({onSubmit:s,isLoading:o,error:i})=>{const[r,x]=t.useState(""),m=l=>{l.preventDefault(),r&&!o&&s(r)};return e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"activation-key",className:"sr-only",children:"Cl√© d'activation"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",id:"activation-key",value:r,onChange:l=>x(l.target.value.toUpperCase()),className:"w-full p-3 pl-10 border-2 bg-black/20 text-white border-white/10 rounded-xl shadow-sm focus:ring-amber-500 focus:border-amber-500 text-center transition placeholder-slate-500",placeholder:"BUVPLUS-XXXX-XXXX-XXXX",autoFocus:!0,required:!0})]})]}),i&&e.jsx("div",{className:"p-3 bg-red-900/50 text-red-300 rounded-lg text-sm font-semibold",children:i}),e.jsx("button",{type:"submit",disabled:o||!r,className:"w-full flex items-center justify-center bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg disabled:bg-slate-600 disabled:opacity-50 disabled:cursor-wait",children:o?e.jsx(X,{className:"w-6 h-6 animate-spin"}):"Activer"})]})},_t=({isFirstRun:s,setPage:o})=>{const{startTrial:i,activateApp:r,currentUser:x,settings:m}=R(),[l,c]=t.useState(!1),[v,p]=t.useState(!1),[b,h]=t.useState(null),d=()=>{c(!0),setTimeout(()=>{i()},300)},w=async k=>{p(!0),h(null);const C=await r(k);C.success||h(C.message||"Cl√© invalide ou d√©j√† utilis√©e. Veuillez v√©rifier et r√©essayer."),p(!1)},g=m.subscriptionExpiry?new Date(m.subscriptionExpiry).toLocaleDateString("fr-FR"):"inconnue",S=e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-display text-amber-400 mt-4",children:"Abonnement Expir√©"}),e.jsxs("p",{className:"text-slate-300 mt-4 max-w-sm mx-auto",children:["Bonjour ",x?.email||"cher utilisateur",", votre abonnement a pris fin le ",g,". R√©activez votre licence pour continuer."]})]}),N=e.jsxs(e.Fragment,{children:[e.jsx("h1",{className:"text-3xl font-display text-amber-400 mt-4",children:"Bienvenue sur Buvette + !"}),e.jsx("p",{className:"text-slate-300 mt-4 max-w-sm mx-auto",children:"D√©bloquez l'application en d√©marrant votre essai gratuit ou en activant une licence."})]});return e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-center p-4 bg-[#1a1a1a]",children:e.jsxs("div",{className:"bg-[#2a2a2a] p-8 rounded-2xl shadow-2xl border-2 border-amber-500/50 max-w-md w-full animate-in fade-in-0 zoom-in-90",children:[e.jsx(xt,{className:"w-16 h-16 text-amber-400 mx-auto"}),s?N:S,e.jsxs("div",{className:"mt-8 space-y-6",children:[s&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("button",{onClick:d,disabled:l,className:"w-full flex items-center justify-center bg-emerald-600 text-white font-bold py-4 px-6 rounded-full shadow-lg hover:bg-emerald-700 transition-all transform hover:scale-105 font-display text-lg disabled:bg-slate-600 disabled:opacity-50",children:l?e.jsx(X,{className:"w-6 h-6 animate-spin"}):"D√©marrer l'essai Premium (7 jours)"}),e.jsxs("div",{className:"flex items-center text-center",children:[e.jsx("hr",{className:"flex-grow border-slate-600"}),e.jsx("span",{className:"px-4 text-slate-400 text-sm font-semibold",children:"OU"}),e.jsx("hr",{className:"flex-grow border-slate-600"})]})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-display text-slate-200 mb-4",children:s?"J'ai d√©j√† une cl√©":"Entrez votre nouvelle cl√©"}),e.jsx(At,{onSubmit:w,isLoading:v,error:b})]}),!s&&e.jsxs("button",{onClick:()=>o(y.Upgrade),className:"w-full flex items-center justify-center gap-2 bg-slate-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-slate-700 transition-all transform hover:scale-105 font-display text-lg",children:[e.jsx(ht,{className:"w-6 h-6"}),"Acheter une nouvelle licence"]})]})]})})},Ut=t.memo(_t),Lt=({daysRemaining:s,plan:o})=>{const i=s<=7,r=o===ee.PRO&&i;let x="";return r?s>1?x=`Essai Pro. Il vous reste ${s} jours.`:s===1?x="Dernier jour de votre essai Pro !":x="Votre essai Pro expire aujourd'hui.":s>1?x=`Abonnement ${o} actif. Il vous reste ${s} jours.`:s===1?x=`Dernier jour de votre abonnement ${o} !`:x=`Votre abonnement ${o} expire aujourd'hui.`,e.jsx("div",{className:`fixed top-0 left-0 right-0 p-2 text-white text-center font-semibold text-xs z-40 shadow-lg ${i?"bg-red-800":"bg-emerald-800"}`,children:e.jsx("p",{children:x})})},Mt=B.memo(Lt),he=t.memo(({className:s="w-36 h-36"})=>e.jsx("img",{src:"/logo.png",alt:"KAY√â Logo",className:`${s} object-contain`})),fe=t.memo(()=>e.jsxs("div",{className:"absolute inset-0 overflow-hidden bg-transparent","aria-hidden":"true",children:[e.jsx("div",{className:"absolute -top-10 -left-10 w-96 h-96 bg-blue-500/20 dark:bg-blue-500/10 rounded-full filter blur-3xl opacity-40 animate-pulse"}),e.jsx("div",{className:"absolute -bottom-10 -right-10 w-80 h-80 bg-orange-500/20 dark:bg-orange-500/10 rounded-full filter blur-3xl opacity-40 animate-pulse [animation-delay:-2s]"}),e.jsx("div",{className:"absolute bottom-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-72 h-72 bg-blue-400/20 dark:bg-blue-400/10 rounded-full filter blur-3xl opacity-40 animate-pulse [animation-delay:-4s]"})]})),ne=["VENTES","STOCKS","STATS","PROFITS"],Rt=({onStart:s})=>{const{settings:o}=R(),[i,r]=t.useState(0),[x,m]=t.useState(!0),[l,c]=t.useState(!1);t.useEffect(()=>{const b=setTimeout(()=>c(!0),100),h=setInterval(()=>{m(!1),setTimeout(()=>{r(d=>(d+1)%ne.length),m(!0)},500)},2500);return()=>{clearTimeout(b),clearInterval(h)}},[]);const v=b=>`transition-all duration-700 ${b} ${l?"opacity-100 translate-y-0 scale-100":"opacity-0 translate-y-5 scale-95"}`,p=o.appFont==="elegant"?"font-display":o.appFont==="handwritten"?"font-handwritten":"font-sans";return e.jsxs("div",{className:"relative h-screen w-screen overflow-hidden flex flex-col justify-center items-center p-4",children:[e.jsx(fe,{}),e.jsxs("div",{className:"relative z-10 flex flex-col items-center text-center w-full h-full",children:[e.jsxs("div",{className:"flex-grow flex flex-col items-center justify-center",children:[e.jsx("div",{className:`mb-6 ${v("delay-100")}`,children:e.jsx(he,{})}),e.jsxs("div",{className:v("delay-300"),children:[e.jsx("h2",{className:`text-6xl md:text-7xl ${p} text-slate-900 dark:text-white drop-shadow-lg`,children:"KAY√â"}),e.jsx("div",{className:"mt-2 text-lg h-8 text-slate-600 dark:text-slate-300 flex items-center justify-center font-semibold tracking-widest",children:e.jsx("div",{className:`transition-opacity duration-500 ease-in-out ${x?"opacity-100":"opacity-0"}`,children:ne[i]})})]})]}),e.jsx("div",{className:`flex-shrink-0 w-full max-w-md mx-auto mb-16 ${v("delay-500")}`,children:e.jsxs("button",{onClick:s,className:`w-full bg-orange-500 text-black font-bold py-4 px-8 rounded-full shadow-lg text-2xl font-display
                       shadow-orange-500/30 hover:shadow-xl hover:shadow-orange-500/40 hover:bg-orange-600 transform hover:scale-105 transition-all duration-300
                       relative overflow-hidden group`,children:[e.jsx("span",{className:"relative z-10",children:"D√©marrer"}),e.jsx("span",{className:"absolute top-0 left-[-100%] w-full h-full bg-white/20 skew-x-[-20deg] transition-all duration-700 group-hover:left-[150%]"})]})})]})]})},oe=t.memo(Rt),Ot=({image:s,alt:o,className:i=""})=>{const r=t.useMemo(()=>s instanceof Blob?URL.createObjectURL(s):typeof s=="string"&&(s.startsWith("data:")||s.startsWith("http"))?s:null,[s]);return t.useEffect(()=>()=>{r&&s instanceof Blob&&URL.revokeObjectURL(r)},[r,s]),r?e.jsx("img",{src:r,alt:o,className:i,loading:"lazy"}):typeof s=="string"?e.jsx("span",{className:`${i} flex items-center justify-center`,"aria-label":o,children:s}):e.jsx("div",{className:`${i} bg-slate-800`})},$t=B.memo(Ot),Bt=({startupMedia:s,onComplete:o})=>{const[i,r]=t.useState(!1);return t.useEffect(()=>{const x=setTimeout(()=>r(!0),100),m=setTimeout(()=>{o()},2500);return()=>{clearTimeout(x),clearTimeout(m)}},[o]),e.jsxs("div",{className:"fixed inset-0 flex items-center justify-center z-[200]","aria-label":"√âcran de d√©marrage de Buvette+",role:"alert","aria-busy":"true",children:[e.jsx(fe,{}),e.jsx("div",{className:`relative z-10 transition-all duration-1000 ease-out ${i?"opacity-100 scale-100":"opacity-0 scale-75"}`,children:s?e.jsx("div",{className:"w-64 h-64 rounded-2xl overflow-hidden shadow-2xl shadow-amber-500/20 border-2 border-amber-500/30 bg-black/20",children:e.jsx($t,{image:s,alt:"M√©dia de d√©marrage",className:"w-full h-full object-contain"})}):e.jsx(he,{})})]})},zt=t.memo(Bt),Ft=({password:s=""})=>{const{hasUpper:o,hasLower:i,hasNumber:r,hasSpecial:x,hasLength:m,strengthText:l,strengthColor:c,score:v}=t.useMemo(()=>{const d=/[A-Z]/.test(s),w=/[a-z]/.test(s),g=/[0-9]/.test(s),S=/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]+/.test(s),N=s.length>=8,k=[d,w,g,S,N].filter(Boolean).length;let C="Tr√®s Faible",D="text-red-400";return k===5?(C="Tr√®s Fort",D="text-emerald-400"):k>=4?(C="Fort",D="text-emerald-400"):k>=3?(C="Moyen",D="text-orange-400"):k>=2&&(C="Faible",D="text-red-400"),{hasUpper:d,hasLower:w,hasNumber:g,hasSpecial:S,hasLength:N,strengthText:C,strengthColor:D,score:k}},[s]),p=[{label:"8+ caract√®res",met:m},{label:"1 majuscule",met:o},{label:"1 minuscule",met:i},{label:"1 chiffre",met:r},{label:"1 sp√©cial",met:x}],b=v/5*100,h=v>=4?"bg-emerald-500":v>=3?"bg-orange-500":"bg-red-500";return e.jsxs("div",{className:"space-y-2 text-left animate-in fade-in-0",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-sm font-semibold text-slate-300",children:"Force du mot de passe :"}),e.jsx("p",{className:`text-sm font-bold ${c}`,children:l})]}),e.jsx("div",{className:"w-full bg-black/30 rounded-full h-1.5",children:e.jsx("div",{className:`h-1.5 rounded-full transition-all duration-300 ${h}`,style:{width:`${b}%`}})}),e.jsx("ul",{className:"grid grid-cols-2 gap-x-4 gap-y-1 text-xs text-slate-400 pt-1",children:p.map(d=>e.jsxs("li",{className:`flex items-center gap-1.5 transition-colors ${d.met?"text-emerald-400":""}`,children:[e.jsx(de,{className:`w-3.5 h-3.5 ${d.met?"opacity-100":"opacity-30"}`}),d.label]},d.label))})]})},Vt=({setPage:s})=>{const{registerUser:o,loginUser:i}=R(),[r,x]=t.useState(!0),[m,l]=t.useState(""),[c,v]=t.useState(""),[p,b]=t.useState(""),[h,d]=t.useState(!1),[w,g]=t.useState(null),[S,N]=t.useState(!1),[k,C]=t.useState(!1),D=t.useId(),U=A=>{if(A.preventDefault(),g(null),!r&&c!==p){g("Les mots de passe ne correspondent pas.");return}N(!0),setTimeout(async()=>{const L=await(r?i(m,c):o(m,c));L.success||g(L.message),N(!1)},300)},P=t.useMemo(()=>!!(S||!m||!c||!r&&(!p||c!==p||!h)),[S,m,c,r,p,h]),j="w-full p-3 border-2 bg-black/20 text-white border-white/10 rounded-xl shadow-sm focus:ring-blue-500 focus:border-blue-500 text-center transition";return e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-center p-4 bg-[#1a1a1a]",children:e.jsxs("div",{className:"bg-[#2a2a2a] p-8 rounded-2xl shadow-2xl border-2 border-blue-500/50 max-w-md w-full animate-in fade-in-0 zoom-in-90",children:[e.jsx("img",{src:"/logo.png",alt:"Logo",className:"w-16 h-16 mx-auto object-contain"}),e.jsx("h1",{className:"text-3xl font-display text-blue-400 mt-4",children:r?"Connexion":"Cr√©er un Compte"}),e.jsx("p",{className:"text-slate-300 mt-2",children:r?"Acc√©dez √† votre espace KAY√â.":"Rejoignez-nous pour g√©rer votre activit√©."}),e.jsxs("form",{onSubmit:U,className:"mt-8 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"sr-only",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:m,onChange:A=>l(A.target.value),className:j,placeholder:"votre.email@exemple.com",required:!0,autoFocus:!0,"aria-invalid":!!w&&(w.includes("email")||w.includes("Email")||w.includes("incorrect")),"aria-describedby":w?D:void 0})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"password",className:"sr-only",children:"Mot de passe"}),e.jsx("input",{type:k?"text":"password",id:"password",value:c,onChange:A=>v(A.target.value),className:j,placeholder:"Mot de passe",required:!0,"aria-invalid":!!w&&(w.includes("passe")||w.includes("incorrect")),"aria-describedby":w?D:void 0}),e.jsx("button",{type:"button",onClick:()=>C(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white transition-colors","aria-label":k?"Cacher le mot de passe":"Afficher le mot de passe",children:k?e.jsx(Z,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})})]}),!r&&e.jsxs("div",{className:"space-y-4 animate-in fade-in-0 duration-500",children:[e.jsxs("div",{className:"relative",children:[e.jsx("label",{htmlFor:"confirm-password",className:"sr-only",children:"Confirmer le mot de passe"}),e.jsx("input",{type:k?"text":"password",id:"confirm-password",value:p,onChange:A=>b(A.target.value),className:j,placeholder:"Confirmer le mot de passe",required:!0,"aria-invalid":!!w&&w.includes("correspondent"),"aria-describedby":w?D:void 0}),e.jsx("button",{type:"button",onClick:()=>C(!k),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white transition-colors","aria-label":k?"Cacher le mot de passe":"Afficher le mot de passe",children:k?e.jsx(Z,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})})]}),c&&e.jsx(Ft,{password:c}),e.jsxs("div",{className:"text-left text-xs text-slate-400 pt-2 flex items-center",children:[e.jsx("input",{type:"checkbox",id:"tos",checked:h,onChange:A=>d(A.target.checked),className:"mr-2 h-4 w-4 rounded accent-orange-500 bg-black/30 border-slate-600",required:!0}),e.jsxs("label",{htmlFor:"tos",children:["J'accepte les ",e.jsx("button",{type:"button",onClick:()=>s(y.TermsOfUse),className:"underline hover:text-orange-300",children:"Conditions d'Utilisation"}),"."]})]})]}),w&&e.jsxs("div",{id:D,role:"alert",className:"flex items-center text-left gap-2 p-3 bg-red-900/50 text-red-300 rounded-lg text-sm font-semibold",children:[e.jsx(ce,{className:"w-5 h-5 flex-shrink-0"}),e.jsx("span",{children:w})]}),e.jsx("button",{type:"submit",disabled:P,className:"w-full flex items-center justify-center bg-orange-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-orange-600 transition-all transform hover:scale-105 font-display text-lg disabled:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed",children:S?e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"w-6 h-6 animate-spin mr-2"}),e.jsx("span",{children:"Chargement..."})]}):r?"Se Connecter":"S'inscrire"})]}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:()=>{x(!r),g(null),v(""),b("")},className:"text-sm text-blue-300 hover:text-blue-200",children:r?"Pas de compte ? Cr√©er un compte":"D√©j√† un compte ? Se connecter"})})]})})},le=t.memo(Vt),qt=({isOpen:s,onClose:o,title:i,children:r})=>{const x=t.useId(),m=t.useRef(null);t.useEffect(()=>{if(!s||!m.current)return;const c=m.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),v=c[0],p=c[c.length-1],b=d=>{if(d.key==="Escape"){o();return}if(d.key==="Tab"){if(c.length===0){d.preventDefault();return}d.shiftKey?document.activeElement===v&&(p.focus(),d.preventDefault()):document.activeElement===p&&(v.focus(),d.preventDefault())}},h=setTimeout(()=>{v?.focus()},100);return document.addEventListener("keydown",b),()=>{clearTimeout(h),document.removeEventListener("keydown",b)}},[s,o]);const l=c=>{c.target===c.currentTarget&&o()};return s?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-80 flex justify-center items-center z-50 p-4",onClick:l,role:"dialog","aria-modal":"true","aria-labelledby":x,children:e.jsxs("div",{ref:m,className:"bg-[#2a2a2a]/80 backdrop-blur-xl rounded-2xl shadow-2xl w-full max-w-sm transform transition-all duration-300 scale-95 animate-in fade-in-0 zoom-in-95 flex flex-col max-h-[85vh] border border-amber-500/30",children:[e.jsxs("div",{className:"flex-shrink-0 px-6 pt-6 pb-4 flex justify-between items-center border-b border-white/10",children:[e.jsx("h2",{id:x,className:"text-xl font-display text-amber-400",children:i}),e.jsx("button",{onClick:o,"aria-label":"Fermer la modale",className:"text-slate-500 hover:text-slate-300 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"overflow-y-auto px-6 pb-6 pt-4",children:r})]})}):null},Ht=B.memo(qt),G=({onClick:s,children:o,className:i=""})=>e.jsx("button",{type:"button",onClick:s,className:`bg-[#2a2a2a] text-white font-bold text-2xl rounded-lg h-14 flex items-center justify-center
                hover:bg-[#3a3a3a] active:bg-[#4a4a4a] transition-all duration-150 shadow-sm border border-white/10 ${i}`,children:o}),Kt=({isOpen:s,onClose:o,user:i})=>{const{loginAdmin:r,loginTeamMember:x,showToast:m}=R(),[l,c]=t.useState(""),[v,p]=t.useState(!1),[b,h]=t.useState(""),[d,w]=t.useState(!1),g=i?.type==="admin",S=4;t.useEffect(()=>{s?g&&setTimeout(()=>{document.getElementById("pin-login-input")?.focus()},100):setTimeout(()=>{c(""),h(""),p(!1),w(!1)},300)},[s,g]);const N=t.useCallback(()=>{p(!0),h(""),setTimeout(()=>{let j;g?j=r(l):i?.type==="team"?j=x(i.user.id,l):j={success:!1,message:"Utilisateur invalide s√©lectionn√©."},j.success?(m(j.message,"success"),o()):(h(j.message),c("")),p(!1)},250)},[g,i,l,r,x,o,m]);t.useEffect(()=>{!g&&l.length===S&&N()},[l,g,S,N]);const k=j=>{j.preventDefault(),l&&N()},C=j=>{v||!g&&l.length>=S||(h(""),c(A=>A+j))},D=()=>{v||c(j=>j.slice(0,-1))},U=g?"Connexion Administrateur":`Connexion de ${i?.type==="team"?i.user.name:""}`,P=g?"Mot de passe":"‚óè ‚óè ‚óè ‚óè";return e.jsx(Ht,{isOpen:s,onClose:o,title:U,children:e.jsxs("form",{onSubmit:k,className:"space-y-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-400 mb-4",children:g?"Veuillez entrer votre mot de passe.":"Veuillez entrer votre code PIN √† 4 chiffres."}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"pin-login-input",type:g&&!d?"password":"text",readOnly:!g,value:g?l:"‚óè".repeat(l.length)+"‚óã".repeat(Math.max(0,S-l.length)),onChange:g?j=>c(j.target.value):void 0,placeholder:P,className:`w-full text-center text-3xl p-3 border-2 bg-[#1a1a1a] text-white border-white/10 rounded-xl shadow-sm font-mono tracking-widest transition-all ${g?"focus:ring-amber-500 focus:border-amber-500":"cursor-default"}`,"aria-label":"Champ de saisie du code"}),g&&e.jsx("button",{type:"button",onClick:()=>w(!d),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-white transition-colors","aria-label":d?"Cacher le mot de passe":"Afficher le mot de passe",children:d?e.jsx(Z,{className:"w-5 h-5"}):e.jsx(Q,{className:"w-5 h-5"})})]}),b&&e.jsx("p",{className:"text-red-400 mt-2 text-sm animate-in fade-in-0",children:b})]}),v?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx(X,{className:"w-10 h-10 animate-spin text-amber-400"})}):e.jsxs(e.Fragment,{children:[!g&&e.jsx("div",{className:"bg-black/20 p-4 rounded-xl shadow-inner",children:e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[["1","2","3","4","5","6","7","8","9"].map(j=>e.jsx(G,{onClick:()=>C(j),children:j},j)),e.jsx("div",{className:"col-start-2",children:e.jsx(G,{onClick:()=>C("0"),children:"0"})}),e.jsx(G,{onClick:D,children:"‚å´"})]})}),g&&e.jsx("button",{type:"submit",disabled:!l||v,className:"w-full mt-3 bg-amber-500 text-black font-bold py-3 rounded-lg shadow-lg hover:bg-amber-600 transition-all font-display text-lg disabled:bg-slate-600 disabled:opacity-50",children:"Se Connecter"})]})]})})},Wt=t.memo(Kt),Xt=()=>{const{settings:s,currentUser:o,logoutUser:i,activeSessionUser:r}=R(),[x,m]=t.useState(null),[l,c]=t.useState(!1),v=t.useCallback(d=>{m(d),c(!0)},[]),p=t.useCallback(()=>{c(!1),m(null)},[]),b=()=>r?r.type==="admin"?"Session Administrateur Active":`Session Vendeur : ${r.user.name}`:"Qui est-ce qui se connecte ?",h=t.memo(({user:d,onClick:w})=>{const g=d==="admin",S=g?"Administrateur":d.name,N=g?ft:pt;return e.jsxs("button",{onClick:w,className:"w-full flex flex-col items-center justify-center p-6 bg-[#2a2a2a] rounded-2xl shadow-md border-2 border-white/10 transition-all duration-300 hover:border-amber-500/80 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-amber-500",children:[e.jsx(N,{className:"w-16 h-16 text-slate-300 mb-3"}),e.jsx("span",{className:"text-xl font-display text-white",children:S}),g&&e.jsx("span",{className:"text-sm text-amber-400 font-semibold",children:"(Acc√®s complet)"})]})});return e.jsxs("div",{className:"flex flex-col items-center justify-center h-screen text-center p-4 bg-[#1a1a1a] animate-in fade-in-0",children:[e.jsxs("div",{className:"w-full max-w-lg",children:[e.jsx(bt,{className:"w-20 h-20 text-amber-400 mx-auto"}),e.jsx("h1",{className:"text-4xl font-display text-amber-400 mt-4",children:b()}),e.jsx("p",{className:"text-slate-300 mt-2 mb-8",children:"S√©lectionnez un profil pour commencer la session de vente."}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 md:gap-6",children:[e.jsx(h,{user:"admin",onClick:()=>v({type:"admin"})}),s.team.map(d=>e.jsx(h,{user:d,onClick:()=>v({type:"team",user:d})},d.id))]}),e.jsx("div",{className:"mt-8",children:e.jsxs("button",{onClick:i,className:"text-sm text-slate-400 hover:text-red-400 transition-colors",children:["Se d√©connecter de ",o?.email]})})]}),e.jsx(Wt,{isOpen:l,onClose:p,user:x})]})},Jt=t.memo(Xt),Gt=({setPage:s})=>{const{clearJustActivatedFlag:o}=R(),i=()=>{o()},r=x=>{x.preventDefault(),s(y.Tutorial),o()};return e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-center p-4 bg-[#1a1a1a] animate-in fade-in-0",children:e.jsxs("div",{className:"bg-[#2a2a2a] p-8 rounded-2xl shadow-2xl border-2 border-emerald-500/50 max-w-lg w-full",children:[e.jsx("div",{className:"mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-emerald-100/10",children:e.jsx(de,{className:"h-10 w-10 text-emerald-400","aria-hidden":"true"})}),e.jsx("h1",{className:"text-3xl font-display text-amber-400 mt-4",children:"F√©licitations ! Votre abonnement est actif !"}),e.jsx("p",{className:"text-slate-300 mt-4 max-w-xl",children:"Pr√©parez-vous √† transformer la gestion de votre buvette. Nous sommes ravis de vous compter parmi les membres de la communaut√© Buvette+. Votre aventure vers une gestion sans effort commence maintenant !"}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:i,className:"w-full max-w-sm bg-amber-500 text-black font-bold py-3 px-8 rounded-full shadow-lg text-lg font-display hover:bg-amber-600 transform hover:scale-105 transition-all duration-300",children:"Acc√©der √† mon tableau de bord"})}),e.jsxs("div",{className:"mt-6 flex justify-center space-x-4",children:[e.jsx("a",{href:"#",onClick:r,className:"text-sm text-slate-400 hover:text-amber-300",children:"Voir le tutoriel"}),e.jsx("span",{className:"text-slate-600",children:"|"}),e.jsx("a",{href:"#",onClick:x=>x.preventDefault(),className:"text-sm text-slate-400 hover:text-amber-300",children:"Centre d'aide"})]})]})})},Yt=()=>{const{activateApp:s,showToast:o}=R(),[i,r]=t.useState(""),[x,m]=t.useState(""),[l,c]=t.useState(!1),v=async p=>{if(p.preventDefault(),m(""),!i){o("Veuillez entrer une cl√© d'activation.","error");return}c(!0);const b=await s(i);b.success||(m(b.message||"Cl√© d'activation incorrecte ou invalide. Veuillez r√©essayer."),setTimeout(()=>m(""),5e3)),c(!1)};return e.jsx("div",{className:"flex flex-col items-center justify-center h-full text-center p-4 bg-[#1a1a1a]",children:e.jsxs("div",{className:"bg-[#2a2a2a] p-8 rounded-2xl shadow-2xl border-2 border-amber-500/50 max-w-md w-full",children:[e.jsx("div",{className:"text-7xl mb-4",children:"‚è≥"}),e.jsx("h1",{className:"text-3xl font-display text-amber-400",children:"Continuez l'aventure Buvette+"}),e.jsx("p",{className:"text-slate-300 mt-4",children:"Votre abonnement a expir√©, mais toutes vos donn√©es sont conserv√©es en s√©curit√©. R√©activez votre licence pour retrouver l'acc√®s √† vos outils de gestion."}),e.jsx("p",{className:"text-sm text-slate-400 mt-4",children:`Besoin d'une nouvelle licence ? Contactez le support ou consultez les offres sur la page "Abonnement".`}),e.jsxs("form",{onSubmit:v,className:"mt-8 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"activation-key",className:"sr-only",children:"Cl√© d'activation"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400",children:e.jsx(te,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",id:"activation-key",value:i,onChange:p=>r(p.target.value.toUpperCase()),className:"w-full p-3 pl-10 border-2 bg-black/20 text-white border-white/10 rounded-lg shadow-sm focus:ring-amber-500 focus:border-amber-500 text-center transition",placeholder:"Entrez votre cl√© ici",autoFocus:!0,required:!0})]})]}),x&&e.jsx("div",{className:"p-3 bg-red-900/50 text-red-300 rounded-lg text-sm font-semibold",children:x}),e.jsx("button",{type:"submit",disabled:l||!i,className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg disabled:bg-slate-600 disabled:opacity-50",children:l?"Activation...":"Activer ma nouvelle licence"})]})]})})},Zt=B.memo(Yt),vs=(s,o={})=>new Promise((i,r)=>{const{quality:x=.75,maxWidth:m=800,maxHeight:l=800}=o,c=50,v=c*1024*1024;if(s.size>v){const b=(s.size/1024/1024).toFixed(1);return r(new Error(`Le fichier est trop volumineux (${b} Mo). Max: ${c} Mo.`))}if(s.type==="image/gif"||s.type.startsWith("video/")){i(s);return}const p=new FileReader;p.onload=b=>{if(!b.target?.result)return r(new Error("Impossible de lire le fichier."));const h=new Image;h.onload=()=>{let d=h.width,w=h.height;d>w?d>m&&(w*=m/d,d=m):w>l&&(d*=l/w,w=l);const g=document.createElement("canvas");g.width=d,g.height=w;const S=g.getContext("2d");if(!S)return r(new Error("Impossible de cr√©er le contexte du canvas."));S.drawImage(h,0,0,d,w),g.toBlob(N=>{N?i(N):r(new Error("La conversion en Blob a √©chou√©."))},"image/jpeg",x)},h.onerror=()=>r(new Error("Erreur lors du chargement de l'image.")),h.src=b.target.result},p.onerror=()=>r(new Error("Erreur de lecture du fichier.")),p.readAsDataURL(s)}),Qt=s=>new Promise((o,i)=>{const r=new FileReader;r.onload=()=>o(r.result),r.onerror=x=>i(x),r.readAsDataURL(s)}),ie=t.lazy(()=>T(()=>import("./HomePage-DdZNqTlw.js"),__vite__mapDeps([0,1,2,3]))),es=t.lazy(()=>T(()=>import("./SalePage-rJu9rpnZ.js"),__vite__mapDeps([4,1,5,3,6]))),ts=t.lazy(()=>T(()=>import("./CartPage-0x5s8n4Z.js"),__vite__mapDeps([7,1,5,8,9,3]))),ss=t.lazy(()=>T(()=>import("./StockPage-B6KncZjR.js"),__vite__mapDeps([10,1,5,3,8,6,9]))),as=t.lazy(()=>T(()=>import("./StatsPage-D1gTc7Vx.js"),__vite__mapDeps([11,1,2,3,9,8]))),rs=t.lazy(()=>T(()=>import("./MorePage-MVg_sD_z.js"),__vite__mapDeps([12,1,13]))),ns=t.lazy(()=>T(()=>import("./SettingsPage-AUaPCV1i.js"),__vite__mapDeps([14,1,13]))),os=t.lazy(()=>T(()=>import("./DonationsPage-Cbw1dU5w.js"),__vite__mapDeps([15,1,5,3]))),ls=t.lazy(()=>T(()=>import("./ResetPage-CiA6Zx7_.js"),__vite__mapDeps([16,1]))),is=t.lazy(()=>T(()=>import("./IdeasPage-DGZNXJ-q.js"),__vite__mapDeps([17,1,18]))),cs=t.lazy(()=>T(()=>import("./UpgradePage-CGrnPdFQ.js"),__vite__mapDeps([19,1]))),ds=t.lazy(()=>T(()=>import("./BackupPage-B3Jnafz4.js"),__vite__mapDeps([20,1,8]))),us=t.lazy(()=>T(()=>import("./TutorialPage-DybEButx.js"),__vite__mapDeps([21,1]))),ms=t.lazy(()=>T(()=>import("./CashOutPage-BXWWuCjn.js"),__vite__mapDeps([22,1,5,3]))),xs=t.lazy(()=>T(()=>import("./TeamPage-D9wsV8FI.js"),__vite__mapDeps([23,1,8]))),hs=t.lazy(()=>T(()=>import("./TermsOfUsePage-BlYqgwlN.js"),__vite__mapDeps([24,1]))),Y=()=>e.jsx("div",{className:"flex h-screen w-screen items-center justify-center",children:e.jsxs("svg",{className:"animate-spin h-12 w-12 text-amber-400",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),fs=()=>{const{currentUser:s,activeSessionUser:o,justActivated:i,settings:r,clearJustActivatedFlag:x,notifications:m,removeNotification:l,isAuthLoading:c}=R(),[v,p]=t.useState(!0),[b,h]=t.useState(y.Home),[d,w]=t.useState(!1),[g,S]=t.useState(null);t.useEffect(()=>{let L=!0;return(async()=>{if(r.backgroundImage)if(r.backgroundImage instanceof Blob){const O=await Qt(r.backgroundImage);L&&S(O)}else typeof r.backgroundImage=="string"&&S(r.backgroundImage);else S(null)})(),()=>{L=!1}},[r.backgroundImage]);const N=()=>{switch(r.appFont){case"elegant":return"font-display";case"handwritten":return"font-handwritten";default:return"font-sans"}};if(v)return e.jsx(zt,{startupMedia:r.startupGif,onComplete:()=>p(!1)});if(c)return e.jsx(Y,{});const k=r.themeMode==="dark",C={backgroundImage:g?`url(${g})`:k?"radial-gradient(circle at top, #1a1a1a 0%, #000 100%)":"radial-gradient(circle at top, #f0f0f0 0%, #e2e8f0 100%)",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"},D={backgroundColor:k?"black":"white",opacity:k?r.backgroundOverlayOpacity??.7:.4},U=()=>{if(b===y.TermsOfUse)return e.jsx(t.Suspense,{fallback:e.jsx(Y,{}),children:e.jsx(hs,{setPage:h})});if(i)return e.jsx(Gt,{setPage:()=>x()});const L=!r.subscriptionExpiry,H=r.subscriptionExpiry&&new Date(r.subscriptionExpiry)<new Date;if(L||H){if(!s)return d?e.jsx(le,{setPage:h}):e.jsx(oe,{onStart:()=>w(!0)});if(L)return e.jsx(Ut,{isFirstRun:!0,setPage:h});if(H)return e.jsx(Zt,{})}return s?o?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:`flex-grow p-4 overflow-y-auto pb-24 ${r.subscriptionExpiry&&j<=7&&j>=0?"pt-8":""}`,children:e.jsx(t.Suspense,{fallback:e.jsx(Y,{}),children:P()})}),e.jsx(Dt,{currentPage:b,setPage:h})]}):e.jsx(Jt,{}):d?e.jsx(le,{setPage:h}):e.jsx(oe,{onStart:()=>w(!0)})},P=()=>{switch(b){case y.Home:return e.jsx(ie,{setPage:h});case y.Sale:return e.jsx(es,{});case y.Cart:return e.jsx(ts,{setPage:h});case y.Stock:return e.jsx(ss,{});case y.Stats:return e.jsx(as,{setPage:h});case y.More:return e.jsx(rs,{setPage:h});case y.Settings:return e.jsx(ns,{setPage:h});case y.Donations:return e.jsx(os,{});case y.Reset:return e.jsx(ls,{setPage:h});case y.Ideas:return e.jsx(is,{});case y.Upgrade:return e.jsx(cs,{});case y.Backup:return e.jsx(ds,{setPage:h});case y.Tutorial:return e.jsx(us,{setPage:h});case y.CashOut:return e.jsx(ms,{setPage:h});case y.Team:return e.jsx(xs,{setPage:h});default:return e.jsx(ie,{setPage:h})}},j=r.subscriptionExpiry?Math.ceil((new Date(r.subscriptionExpiry).getTime()-new Date().getTime())/(1e3*60*60*24)):0,A={"--primary":r.brandColor||"#2563eb"};return e.jsxs("div",{className:`font-sans h-screen w-screen overflow-hidden flex flex-col transition-colors duration-500
            ${N()}-headings 
            ${k?"dark text-slate-100":"text-slate-900"}
            `,style:{...C,...A},children:[e.jsx("div",{className:"absolute inset-0 z-0 pointer-events-none transition-opacity duration-500",style:D}),e.jsxs("div",{className:"relative z-10 flex flex-col h-full w-full",children:[r.subscriptionExpiry&&j<=7&&j>=0&&e.jsx(Mt,{daysRemaining:j,plan:r.subscriptionPlan}),U()]}),e.jsx("div",{className:"fixed bottom-24 right-0 p-4 z-[100] w-full max-w-md space-y-2 pointer-events-none",children:m.map(L=>e.jsx(Tt,{notification:L,onClose:l},L.id))})]})};class ps extends B.Component{state={hasError:!1,error:null,errorInfo:null};static getDerivedStateFromError(o){return{hasError:!0,error:o}}componentDidCatch(o,i){console.error("Uncaught error:",o,i),this.setState({errorInfo:i})}handleReload=()=>{window.location.reload()};render(){return this.state.hasError?e.jsx("div",{className:"flex flex-col items-center justify-center h-screen text-center p-4 bg-[#1a1a1a]",children:e.jsxs("div",{className:"bg-[#2a2a2a] p-8 rounded-2xl shadow-2xl border-2 border-red-500/50 max-w-lg w-full",children:[e.jsx(ce,{className:"w-16 h-16 text-red-400 mx-auto"}),e.jsx("h1",{className:"text-3xl font-display text-red-300 mt-4",children:"Oups ! Une erreur est survenue."}),e.jsx("p",{className:"text-slate-300 mt-4",children:"Notre application a rencontr√© un probl√®me inattendu. Ne vous inqui√©tez pas, vos donn√©es sont probablement en s√©curit√©. Veuillez essayer de rafra√Æchir la page pour continuer."}),e.jsx("button",{onClick:this.handleReload,className:"mt-8 w-full max-w-sm bg-amber-500 text-black font-bold py-3 px-8 rounded-full shadow-lg text-lg font-display hover:bg-amber-600 transform hover:scale-105 transition-all duration-300",children:"Rafra√Æchir la page"}),e.jsxs("details",{className:"mt-6 text-left text-xs text-slate-400 bg-black/30 p-3 rounded-lg",children:[e.jsx("summary",{className:"cursor-pointer font-semibold hover:text-white",children:"D√©tails techniques"}),e.jsxs("pre",{className:"mt-2 whitespace-pre-wrap break-all font-mono",children:[this.state.error?.toString(),e.jsx("br",{}),this.state.errorInfo?.componentStack]})]})]})}):this.props.children}}const pe=document.getElementById("root");if(!pe)throw new Error("Could not find root element to mount to");const bs=gt.createRoot(pe);bs.render(e.jsx(B.StrictMode,{children:e.jsx(kt,{children:e.jsx(ps,{children:e.jsx(fs,{})})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(s=>{console.log("ServiceWorker registration successful with scope: ",s.scope)}).catch(s=>{console.log("ServiceWorker registration failed: ",s)})});export{Ht as M,$t as P,T as _,Qt as b,vs as c,R as u};

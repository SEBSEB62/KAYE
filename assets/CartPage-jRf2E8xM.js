import{r as n,P as Y,j as e,i as fe,B as ge,D as je,F as Ne,Q as X}from"./Icons-C56Ecv4l.js";import{u as V,b as ye,P as we,M as _}from"./main-C139bshK.js";import{N as Z}from"./NumericKeypad-CSJS3737.js";import{C as ke}from"./ConfirmModal-TT8ZDJRN.js";import{E as ve,a as Ce}from"./jspdf.plugin.autotable-CE8aeFnn.js";import{f as c}from"./formatting-B5pXF3od.js";const Se=n.memo(({transaction:b,onNewSale:f,onGenerateReceipt:a})=>{const{settings:g}=V(),{sale:l,cashReceived:j}=b,N=(j??0)-l.total;return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-4",children:[e.jsx("div",{className:"text-8xl",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-24 w-24 text-emerald-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("h1",{className:"text-4xl font-display text-amber-400 mt-4",children:["Vente de ",c(l.total)," ComplÃ¨te !"]}),l.customerName&&e.jsxs("p",{className:"text-slate-300 mt-2 text-lg",children:["Client: ",l.customerName]}),l.paymentMethod==="cash"&&j!==void 0&&e.jsxs("div",{className:"mt-4 text-center p-4 bg-emerald-900/50 rounded-lg border border-emerald-700 w-full max-w-xs space-y-2",children:[e.jsxs("p",{className:"text-sm text-slate-400",children:["Montant reÃ§u : ",c(Number(j))]}),N>=0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-xl text-emerald-300",children:"Monnaie Ã  rendre :"}),e.jsx("p",{className:"text-4xl font-display text-emerald-200",children:c(N)})]})]}),e.jsxs("div",{className:"mt-8 flex flex-col sm:flex-row gap-4 w-full max-w-sm",children:[g.businessName&&e.jsx("button",{onClick:()=>a(l),className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:"GÃ©nÃ©rer Ticket"}),e.jsx("button",{onClick:f,className:"w-full bg-slate-600 text-slate-200 font-bold py-3 px-6 rounded-full shadow-lg hover:bg-slate-700 transition-colors font-display text-lg",children:"Nouvelle Vente"})]})]})}),Me=n.memo(({isOpen:b,onClose:f,item:a})=>{const{updateCartQuantity:g,products:l,showToast:j}=V(),[N,w]=n.useState(""),E=n.useMemo(()=>a?l.find(o=>o.id===a.id):null,[l,a]),k=a?.isMisc?1/0:E?.stock??0;n.useEffect(()=>{a&&w(String(a.quantity))},[a]);const S=()=>{const o=parseInt(N,10);a&&!isNaN(o)&&(o>k?(j(`Stock insuffisant. ${k} disponible(s).`,"error"),g(a.id,k)):g(a.id,o)),f()},d=o=>{o!=="."&&w(M=>M==="0"?o:M+o)},y=()=>{w(o=>o.length>1?o.slice(0,-1):"0")};return a?e.jsx(_,{isOpen:b,onClose:f,title:"Modifier QuantitÃ©",children:e.jsxs("div",{className:"space-y-4 text-center",children:[e.jsx("p",{className:"text-xl text-slate-200 font-display",children:a.name}),!a.isMisc&&e.jsxs("p",{className:"text-sm text-slate-400",children:["Stock disponible : ",k]}),e.jsx("input",{type:"text",readOnly:!0,value:N,className:"block w-full text-center text-4xl p-2 border-white/20 rounded-md shadow-sm bg-[#1a1a1a] text-white font-sans"}),e.jsx(Z,{onKeyPress:d,onDelete:y,onDone:S})]})}):null}),Pe=({setPage:b})=>{const{cart:f,cartTotal:a,cartTokenTotal:g,settings:l,cartCount:j,removeFromCart:N,processSale:w,clearCart:E}=V(),[k,S]=n.useState(!1),[d,y]=n.useState(""),[o,M]=n.useState(!1),[q,O]=n.useState(null),[ee,F]=n.useState(!1),[te,B]=n.useState(!1),[K,A]=n.useState(null),[W,Q]=n.useState(!1),[L,J]=n.useState(""),U=n.useCallback((t,s)=>{Q(!1);const P=w(t,L);O({sale:P,cashReceived:s}),M(!0),t==="cash"&&(S(!1),F(!1),y(""))},[w,L]),se=()=>{U("cash",Number(d))},v=t=>{U(t)},ae=n.useCallback(async t=>{const s=new ve,{businessName:P,businessAddress:I,businessContact:z,receiptFooter:C,businessLogo:h}=l,he=s.internal.pageSize.getHeight(),u=s.internal.pageSize.getWidth(),x=14;let i=20;if(h)try{let r="";if(h instanceof Blob?r=await ye(h):typeof h=="string"&&h.startsWith("data:")&&(r=h),r){const m=new Image;m.src=r,await new Promise(H=>{m.onload=H,m.onerror=H});const T=15,G=m.width*T/m.height,be=u/2-G/2;s.addImage(r,"PNG",be,15,G,T),i=35}}catch(r){console.error("Could not add logo to receipt:",r)}s.setFont("helvetica","bold"),s.setFontSize(20),s.text(P||"Buvette",u/2,i,{align:"center"}),i+=8,s.setFont("helvetica","normal"),s.setFontSize(10),I&&(s.text(I,u/2,i,{align:"center"}),i+=5),z&&(s.text(z,u/2,i,{align:"center"}),i+=5),i+=10,s.setFont("helvetica","bold"),s.setFontSize(12),s.text("Ticket de Caisse",x,i),s.setFont("helvetica","normal"),s.setFontSize(10),s.text(`Transaction : #${t.id.slice(-6)}`,x,i+7),s.text(`Date : ${new Date(t.date).toLocaleString("fr-FR")}`,x,i+12),t.customerName&&(s.text(`Client : ${t.customerName}`,x,i+17),i+=5);const ue=["Produit","QtÃ©","P.U.","Total"],R=[];t.items.forEach(r=>{const m=l.tokenMode?r.tokenPrice||0:r.price,T=m*r.quantity;l.tokenMode?R.push([r.name,r.quantity,`${m.toFixed(0)} J`,`${T.toFixed(0)} J`]):R.push([r.name,r.quantity,`${c(m)}`,`${c(T)}`])}),Ce(s,{head:[ue],body:R,startY:i+20,theme:"plain",headStyles:{fontStyle:"bold",fillColor:!1,textColor:20},styles:{fontSize:10},columnStyles:{0:{cellWidth:"auto"},1:{cellWidth:20,halign:"center"},2:{cellWidth:30,halign:"right"},3:{cellWidth:30,halign:"right"}}});const D=s.lastAutoTable.finalY||120;s.setDrawColor(180),s.line(x,D+6,u-x,D+6),s.setFontSize(16),s.setFont("helvetica","bold");const pe=`TOTAL : ${l.tokenMode?`${t.total} Jeton${t.total>1?"s":""}`:`${c(t.total)}`}`;s.text(pe,u-x,D+15,{align:"right"});let p="";switch(t.paymentMethod){case"card":p="Carte Bancaire";break;case"token":p="Jetons";break;case"cash":p="EspÃ¨ces";break;case"check":p="ChÃ¨que";break;case"paypal":p="PayPal";break;case"wero":p="Wero";break;default:p="Autre";break}s.setFontSize(10),s.setFont("helvetica","normal"),s.text(`PayÃ© par : ${p}`,x,D+15),C&&(s.setFontSize(9),s.setTextColor(100),s.text(C,u/2,he-15,{align:"center",maxWidth:u-x*2})),s.save(`ticket-${t.id}.pdf`)},[l]),le=n.useCallback(()=>{M(!1),O(null),J(""),b(Y.Sale)},[b]),ne=t=>{t==="."&&d.includes(".")||y(s=>s+t)},re=()=>{y(t=>t.slice(0,-1))},oe=t=>{if(t<=5)return[5,10,20];if(t<=10)return[10,20,50];if(t<=20)return[20,50,100];const s=Math.ceil(t/5)*5,P=Math.ceil(t/10)*10,I=Math.ceil(t/20)*20,z=[s,P,I].filter(C=>C>t);return[...new Set(z)].sort((C,h)=>C-h).slice(0,3)},ie=n.useMemo(()=>oe(a),[a]),$=Number(d)-a,ce=a*.0175,de=a-ce,xe=a>0?a*.029+.35:0,me=Math.max(0,a-xe);return o&&q?e.jsx(Se,{transaction:q,onNewSale:le,onGenerateReceipt:ae}):f.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx("div",{className:"text-7xl",children:"ðŸ›’"}),e.jsx("h1",{className:"text-3xl font-display text-slate-200 mt-4",children:"Panier Vide"}),e.jsx("p",{className:"text-slate-400 mt-2",children:"Ajoutez des produits depuis la page de vente."}),e.jsx("button",{onClick:()=>b(Y.Sale),className:"mt-6 bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-transform font-display text-lg",children:"Parcourir les produits"})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("h1",{className:"text-4xl font-display text-amber-400",children:["Panier (",j,")"]}),e.jsx("button",{onClick:()=>Q(!W),className:"font-bold text-amber-400 px-4 py-2 rounded-lg transition-colors hover:bg-white/10",children:W?"TerminÃ©":"Modifier"})]}),e.jsxs("div",{className:"space-y-3",children:[f.map(t=>e.jsxs("div",{className:"glass-panel p-3 rounded-xl shadow-sm border border-white/10 flex items-center gap-3",children:[W&&e.jsx("button",{onClick:()=>N(t.id),className:"text-red-300 hover:text-red-200 animate-in fade-in-0 zoom-in-90","aria-label":`Supprimer ${t.name}`,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-7 w-7",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex items-center space-x-4 flex-grow",children:[e.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden bg-white/20 dark:bg-black/20 flex items-center justify-center flex-shrink-0 border border-white/10",children:e.jsx(we,{image:t.image,alt:t.name,className:"w-full h-full object-contain text-3xl"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-slate-800 dark:text-slate-200",children:t.name}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-slate-400",children:l.tokenMode?`${t.tokenPrice||0} Jeton(s)`:`${c(t.price)}`})]})]}),e.jsx("button",{onClick:()=>A(t),className:"px-5 py-3 text-slate-800 dark:text-slate-200 font-semibold text-lg border border-slate-300 dark:border-white/20 rounded-lg transition-colors hover:bg-white/20 min-w-[60px] text-center","aria-label":`Modifier la quantitÃ© pour ${t.name}, actuellement ${t.quantity}`,children:t.quantity})]},t.id)),e.jsx("div",{className:"flex justify-end items-center pt-4 border-t border-white/10 mt-4",children:e.jsx("button",{onClick:()=>B(!0),className:"text-sm text-slate-500 hover:text-red-500 transition-colors",children:"Vider le panier"})})]}),e.jsxs("div",{className:"mt-6 p-5 glass-panel rounded-2xl shadow-lg border-2 border-amber-500/50",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-2xl font-display text-slate-800 dark:text-slate-200",children:"Total:"}),l.tokenMode?e.jsxs("span",{className:"text-3xl font-display text-amber-600 dark:text-amber-300",children:[g," Jeton",g>1?"s":""]}):e.jsx("span",{className:"text-3xl font-display text-amber-600 dark:text-amber-300",children:c(a)})]}),!l.tokenMode&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-300/20 dark:border-white/10 text-xs space-y-1",children:[e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Net si paiement CB (SumUp) :"}),e.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:c(de)})]}),e.jsxs("div",{className:"flex justify-between text-slate-600 dark:text-slate-400",children:[e.jsx("span",{children:"Net si paiement PayPal :"}),e.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:c(me)})]})]})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 pointer-events-none",children:e.jsx(fe,{className:"w-5 h-5"})}),e.jsx("input",{type:"text",value:L,onChange:t=>J(t.target.value),placeholder:"Nom du client (optionnel)",className:"w-full p-3 pl-10 bg-white/20 dark:bg-[#1a1a1a] border border-white/20 text-slate-900 dark:text-white rounded-xl shadow-sm focus:ring-amber-500 focus:border-amber-500 transition placeholder-slate-500 dark:placeholder-slate-400"})]}),l.tokenMode?e.jsx("button",{onClick:()=>v("token"),className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:"Valider l'Ã©change"}):e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:()=>S(!0),className:"col-span-1 flex items-center justify-center bg-white/10 dark:bg-transparent text-amber-600 dark:text-amber-400 border-2 border-amber-500 dark:border-amber-400 font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-amber-500/10 transition-all transform hover:scale-105 font-display text-lg",children:[e.jsx(ge,{className:"w-6 h-6 mr-2"}),"EspÃ¨ces"]}),e.jsxs("button",{onClick:()=>v("card"),className:"col-span-1 flex items-center justify-center bg-amber-500 text-black font-bold py-3 px-4 rounded-xl shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:[e.jsx(je,{className:"w-6 h-6 mr-2"}),"Carte"]}),e.jsxs("button",{onClick:()=>v("check"),className:"flex flex-col items-center justify-center bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 font-bold py-2 px-2 rounded-xl shadow hover:opacity-90 transition-all",children:[e.jsx(Ne,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"ChÃ¨que"})]}),e.jsxs("button",{onClick:()=>v("paypal"),className:"flex flex-col items-center justify-center bg-[#003087] text-white font-bold py-2 px-2 rounded-xl shadow hover:opacity-90 transition-all",children:[e.jsx(X,{className:"w-5 h-5 mb-1"}),e.jsx("span",{className:"text-xs",children:"PayPal"})]}),e.jsxs("button",{onClick:()=>v("wero"),className:"col-span-2 flex items-center justify-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-xl shadow hover:opacity-90 transition-all",children:[e.jsx(X,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Wero (Virement InstantanÃ©)"})]})]}),!l.tokenMode&&l.appMode==="association"&&e.jsx("div",{className:"pt-2 text-center",children:e.jsx("button",{onClick:()=>v("token"),className:"text-amber-500 hover:text-amber-400 text-sm font-bold underline decoration-dotted",children:"Payer en Jetons"})})]}),e.jsx(_,{isOpen:k,onClose:()=>{S(!1),F(!1)},title:"Paiement EspÃ¨ces",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{className:"text-center text-lg text-slate-200",children:["Total Ã  payer: ",e.jsx("span",{className:"font-bold text-2xl font-display text-amber-400",children:c(a)})]}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[e.jsx("button",{onClick:()=>y(a.toFixed(2)),className:"py-2 px-3 text-sm font-bold bg-white/10 rounded-lg hover:bg-white/20 transition-colors",children:"Exact"}),ie.map(t=>e.jsxs("button",{onClick:()=>y(String(t)),className:"py-2 px-3 text-sm font-bold bg-white/10 rounded-lg hover:bg-white/20 transition-colors",children:[t,"â‚¬"]},t))]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"cash",className:"block text-sm font-medium text-slate-300 mb-2 text-center",children:"Montant reÃ§u"}),e.jsx("input",{type:"text",id:"cash",readOnly:!0,value:d,onFocus:()=>F(!0),placeholder:"0.00",className:"block w-full text-center text-3xl p-3 border-2 border-white/20 rounded-xl shadow-sm focus:ring-amber-500 focus:border-amber-500 bg-[#1a1a1a] text-white cursor-pointer font-sans"})]}),d&&$>=0&&e.jsxs("div",{className:"text-center p-3 bg-emerald-900/50 rounded-lg border border-emerald-700",children:[e.jsx("p",{className:"text-lg text-emerald-300",children:"Monnaie Ã  rendre:"}),e.jsx("p",{className:"text-3xl font-display text-emerald-300",children:c($)})]}),d&&$<0&&e.jsx("div",{className:"text-center p-3 bg-red-900/50 rounded-lg border border-red-700",children:e.jsx("p",{className:"text-lg text-red-300",children:"Montant insuffisant"})}),ee?e.jsx(Z,{onKeyPress:ne,onDelete:re,onDone:()=>F(!1)}):e.jsx("button",{onClick:se,disabled:!d||$<0,className:"w-full bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg disabled:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed",children:"Confirmer Vente"})]})}),e.jsx(ke,{isOpen:te,onClose:()=>B(!1),onConfirm:E,title:"Vider le panier",message:"ÃŠtes-vous sÃ»r de vouloir supprimer tous les articles du panier ? Cette action est irrÃ©versible.",confirmText:"Vider"}),e.jsx(Me,{isOpen:!!K,onClose:()=>A(null),item:K})]})},We=n.memo(Pe);export{We as default};

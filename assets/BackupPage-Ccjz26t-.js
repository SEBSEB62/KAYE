import{r as n,j as e,Y as j,P as v,I as N,a3 as w}from"./Icons-C56Ecv4l.js";import{u as y}from"./main-sP1ObtPy.js";import{C}from"./ConfirmModal-BKYg9vdT.js";const I=({setPage:p})=>{const{currentUser:l,restoreUserData:x,showToast:t}=y(),[f,d]=n.useState(!1),[i,c]=n.useState(null),u=n.useRef(null),h=n.useCallback(()=>{if(!l){t("Aucun utilisateur n'est connecté.","error");return}try{const r=localStorage.getItem(`buv-data-${l.id}`);if(!r){t("Aucune donnée à exporter.","error");return}const s=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(s),o=document.createElement("a"),m=new Date().toISOString().slice(0,10);o.href=a,o.download=`buvette-plus-sauvegarde-${l.email}-${m}.json`,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a),t("Exportation réussie !","success")}catch(r){console.error("Export failed:",r),t("L'exportation a échoué.","error")}},[l,t]),b=r=>{const s=r.target.files?.[0];if(s){if(s.type!=="application/json"){t("Veuillez sélectionner un fichier de sauvegarde JSON valide.","error");return}c(s),d(!0)}r.target.value=""},g=()=>{if(!i)return;const r=new FileReader;r.onload=s=>{try{const a=s.target?.result;if(typeof a!="string")throw new Error("Le fichier est vide ou illisible.");const o=JSON.parse(a);x(o)||t("Le fichier de sauvegarde est invalide ou corrompu.","error")}catch(a){console.error("Import failed:",a),t("Erreur lors de la lecture du fichier de sauvegarde.","error")}finally{c(null)}},r.onerror=()=>{t("Impossible de lire le fichier.","error"),c(null)},r.readAsText(i)};return e.jsxs("div",{className:"space-y-8 max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-4xl font-display text-amber-400",children:"Sauvegarde"}),e.jsx("button",{onClick:()=>p(v.More),className:"text-slate-300 hover:text-amber-400 p-2 rounded-full transition-colors","aria-label":"Retour",children:e.jsx(j,{className:"w-6 h-6"})})]}),e.jsx("p",{className:"text-center text-slate-400",children:"Exportez vos données pour les conserver en sécurité ou pour les transférer sur un autre appareil."}),e.jsxs("div",{className:"bg-[#2a2a2a] p-6 rounded-2xl shadow-md border border-white/10 text-center",children:[e.jsxs("h2",{className:"text-2xl font-display text-slate-200 flex items-center justify-center gap-2",children:[e.jsx(N,{className:"w-6 h-6"}),"Exporter les données"]}),e.jsx("p",{className:"text-slate-300 mt-2 mb-4",children:"Téléchargez un fichier JSON contenant toutes vos données actuelles (produits, ventes, paramètres, etc.)."}),e.jsx("button",{onClick:h,className:"bg-amber-500 text-black font-bold py-3 px-6 rounded-full shadow-lg hover:bg-amber-600 transition-all transform hover:scale-105 font-display text-lg",children:"Télécharger ma sauvegarde"})]}),e.jsxs("div",{className:"bg-[#2a2a2a] p-6 rounded-2xl shadow-md border-2 border-red-500/50 text-center",children:[e.jsxs("h2",{className:"text-2xl font-display text-red-400 flex items-center justify-center gap-2",children:[e.jsx(w,{className:"w-6 h-6"}),"Restaurer une sauvegarde"]}),e.jsxs("div",{className:"mt-2 mb-4 bg-red-900/40 p-3 rounded-lg",children:[e.jsx("p",{className:"font-bold text-red-300",children:"ATTENTION : DANGER"}),e.jsx("p",{className:"text-slate-300 text-sm",children:"Importer un fichier écrasera **toutes vos données actuelles** de façon irréversible."})]}),e.jsx("button",{onClick:()=>u.current?.click(),className:"bg-red-600 text-white font-bold py-3 px-6 rounded-full shadow-lg hover:bg-red-700 transition-all transform hover:scale-105 font-display text-lg",children:"Importer un fichier"}),e.jsx("input",{type:"file",ref:u,onChange:b,accept:"application/json,.json",className:"hidden"})]}),e.jsx(C,{isOpen:f,onClose:()=>{d(!1),c(null)},onConfirm:g,title:"Confirmer la Restauration",message:e.jsxs(e.Fragment,{children:["Êtes-vous absolument certain(e) de vouloir restaurer les données depuis le fichier ",e.jsx("strong",{children:i?.name})," ?",e.jsx("br",{}),e.jsx("br",{}),"Cette action remplacera toutes vos données actuelles et ne peut pas être annulée."]}),confirmText:"Oui, Écraser & Restaurer"})]})},O=n.memo(I);export{O as default};
